<!DOCTYPE html>
<html>
  <head>
    <title>MCP-ANY-REST Configuration</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: #f8f9fa;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 0;
        border: none;
        box-shadow: none;
      }

      /* Module Cards Layout */
      .module-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      @media (max-width: 768px) {
        .module-cards {
          grid-template-columns: 1fr;
        }
      }

      @media (min-width: 1200px) {
        .module-cards {
          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }
      }

      .module-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        background: white;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .module-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      }

      .module-card-header {
        padding: 20px;
        background: #2196f3;
        color: white;
      }

      .module-card-header h3 {
        margin: 0;
        font-size: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .module-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .module-status.enabled {
        background: rgba(76, 175, 80, 0.9);
      }

      .module-status.disabled {
        background: rgba(244, 67, 54, 0.9);
      }

      .module-card-content {
        padding: 20px;
      }

      /* Configuration Form Styles */
      .config-form {
        display: grid;
        gap: 15px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
        font-size: 14px;
      }

      .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .form-group input {
        width: calc(100% - 25px);
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #2196f3;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: #2196f3;
      }

      input:checked + .toggle-slider:before {
        transform: translateX(26px);
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: #2196f3;
        color: white;
      }

      /* Tree-based Configuration Styles */
      .config-tree-container {
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .tree-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
      }

      .tree-controls input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .tree-controls .btn {
        padding: 6px 12px;
        font-size: 14px;
      }

      .config-tree {
        max-height: 600px;
        overflow-y: auto;
        border: 1px solid #eee;
        border-radius: 4px;
        padding: 10px;
      }

      .tree-node {
        margin-left: 20px;
        border-left: 1px solid #e0e0e0;
        padding-left: 10px;
      }

      .tree-item {
        display: flex;
        align-items: center;
        padding: 8px 5px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .tree-item:hover {
        background-color: #f8f9fa;
      }

      .tree-item.expanded {
        background-color: #e3f2fd;
      }

      .tree-toggle {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 5px;
        cursor: pointer;
        font-weight: bold;
        color: #666;
      }

      .tree-toggle::before {
        content: "▶";
        font-size: 12px;
        transition: transform 0.2s;
      }

      .tree-toggle.expanded::before {
        transform: rotate(90deg);
      }

      .tree-label {
        font-weight: 600;
        color: #333;
        min-width: 200px;
      }

      .tree-value {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tree-input {
        flex: 1;
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 3px;
        font-size: 14px;
      }

      .tree-select {
        flex: 1;
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 3px;
        font-size: 14px;
      }

      .tree-checkbox {
        width: 18px;
        height: 18px;
      }

      .tree-actions {
        display: flex;
        gap: 5px;
        margin-left: 10px;
      }

      .tree-btn {
        padding: 4px 8px;
        font-size: 12px;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: white;
        cursor: pointer;
      }

      .tree-btn:hover {
        background: #f0f0f0;
      }

      .tree-btn.add {
        background: #28a745;
        color: white;
        border-color: #28a745;
      }

      .tree-btn.remove {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .tree-type {
        font-size: 12px;
        color: #666;
        font-style: italic;
        margin-left: 10px;
      }

      .tree-description {
        font-size: 12px;
        color: #888;
        margin-left: 10px;
      }

      .hidden {
        display: none !important;
      }

      /* Enhanced Tree Configuration Styles */
      .category-section {
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .category-header {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #f8f9fa;
        cursor: pointer;
        transition: background-color 0.2s;
        border-bottom: 1px solid #e0e0e0;
      }

      .category-header:hover {
        background: #e9ecef;
      }

      .category-toggle {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        cursor: pointer;
        font-weight: bold;
        color: #666;
      }

      .category-toggle::before {
        content: "▶";
        font-size: 12px;
        transition: transform 0.2s;
      }

      .category-toggle.expanded::before {
        transform: rotate(90deg);
      }

      .category-title {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .category-label {
        font-weight: 600;
        font-size: 16px;
        color: #333;
      }

      .category-description {
        font-size: 12px;
        color: #666;
        font-style: italic;
      }

      .category-type {
        font-size: 12px;
        color: #666;
        background: #e9ecef;
        padding: 4px 8px;
        border-radius: 12px;
      }

      .category-content {
        padding: 15px;
        background: white;
      }

      .dynamic-item {
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-bottom: 10px;
        overflow: hidden;
      }

      .dynamic-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
      }

      .dynamic-label {
        font-weight: 600;
        color: #333;
      }

      .dynamic-actions {
        display: flex;
        gap: 5px;
      }

      .dynamic-btn {
        padding: 4px 8px;
        font-size: 12px;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .dynamic-btn:hover {
        background: #f0f0f0;
      }

      .dynamic-btn.edit {
        background: #17a2b8;
        color: white;
        border-color: #17a2b8;
      }

      .dynamic-btn.remove {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .value-preview {
        padding: 10px 15px;
        font-size: 14px;
        color: #666;
        background: #fafafa;
      }

      .static-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background: #fafafa;
        border-radius: 4px;
      }

      .static-label {
        font-weight: 600;
        color: #333;
        min-width: 150px;
      }

      .static-value {
        flex: 1;
      }

      .config-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .config-checkbox {
        width: 18px;
        height: 18px;
      }

      .config-select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        background-color: white;
        cursor: pointer;
      }

      .config-select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
      }

      /* Enhanced Configuration Editor Styles */
      .config-editor-container {
        margin-top: 20px;
      }

      .config-sections {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .config-section {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background-color: #fff;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .config-section:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .section-header {
        background-color: #f8f9fa;
        padding: 15px 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e0e0e0;
        transition: background-color 0.2s ease;
      }

      .section-header:hover {
        background-color: #e9ecef;
      }

      .section-header h4 {
        margin: 0;
        color: #333;
        font-size: 16px;
        font-weight: 600;
      }

      .section-toggle {
        font-size: 12px;
        color: #666;
        transition: transform 0.3s ease;
      }

      .section-content {
        padding: 20px;
        display: block;
      }

      .config-section.collapsed .section-content {
        display: none;
      }

      .config-section.collapsed .section-toggle {
        transform: rotate(-90deg);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #555;
      }

      .auth-subsection {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #007bff;
      }

      .auth-subsection h5 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 14px;
        font-weight: 600;
      }

      .module-list {
        margin-top: 20px;
      }

      .module-list h5 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 14px;
        font-weight: 600;
      }

      .module-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        margin-bottom: 8px;
        background-color: #fff;
      }

      .module-item:last-child {
        margin-bottom: 0;
      }

      .module-name {
        font-weight: 500;
        color: #333;
      }

      .module-status {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #28a745;
      }

      .status-indicator.disabled {
        background-color: #dc3545;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .config-sections {
          gap: 10px;
        }

        .section-header {
          padding: 12px 15px;
        }

        .section-content {
          padding: 15px;
        }

        .form-group {
          margin-bottom: 12px;
        }
      }

      .null-field {
        padding: 15px;
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 4px;
        text-align: center;
      }

      .null-label {
        color: #856404;
        font-style: italic;
      }

      .null-value {
        color: #999;
        font-style: italic;
      }

      .add-item-section {
        text-align: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
      }

      .add-item-btn {
        padding: 8px 16px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .add-item-btn:hover {
        background: #218838;
      }

      .btn-success {
        background: #4caf50;
        color: white;
      }

      .btn-info {
        background: #17a2b8;
        color: white;
      }

      .btn-danger {
        background: #f44336;
        color: white;
      }

      .btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        animation: slideInDown 0.3s ease;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        background: #f8f9fa;
        border-radius: 8px 8px 0 0;
      }

      .modal-header h3 {
        margin: 0;
        color: #333;
      }

      .modal-header .close {
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        color: #666;
        padding: 0 5px;
      }

      .modal-header .close:hover {
        color: #333;
      }

      .modal-body {
        padding: 20px;
        max-height: 60vh;
        overflow-y: auto;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 20px;
        border-top: 1px solid #e9ecef;
        background: #f8f9fa;
        border-radius: 0 0 8px 8px;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .preset-management-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e9ecef;
      }

      .preset-list {
        background: white;
        border-radius: 6px;
        border: 1px solid #dee2e6;
      }

      .preset-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #e9ecef;
      }

      .preset-item:last-child {
        border-bottom: none;
      }

      .preset-info {
        flex: 1;
      }

      .preset-name {
        font-weight: 600;
        color: #333;
        margin: 0 0 5px 0;
      }

      .preset-description {
        font-size: 14px;
        color: #666;
        margin: 0;
      }

      .preset-actions {
        display: flex;
        gap: 10px;
      }

      .preset-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
      }

      .preset-btn.apply {
        background: #4caf50;
        color: white;
      }

      .preset-btn.delete {
        background: #f44336;
        color: white;
      }

      .preset-btn:hover {
        opacity: 0.9;
      }

      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Status and Preview Styles */
      .status {
        padding: 15px;
        margin: 20px 0;
        border-radius: 6px;
        font-weight: 600;
      }

      .success {
        background: #e8f5e8;
        border: 2px solid #4caf50;
        color: #2e7d32;
      }

      .error {
        background: #ffebee;
        border: 2px solid #f44336;
        color: #c62828;
      }

      .json-viewer {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        max-height: 500px;
        overflow-y: auto;
        font-family: "Fira Code", "Monaco", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.4;
      }

      .json-viewer pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
      }

      /* Changes Table Styles */
      .changes-table-container {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        max-height: 300px;
        overflow-y: auto;
      }

      .changes-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      .changes-table th {
        background: #e9ecef;
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
      }

      .changes-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #dee2e6;
        vertical-align: top;
      }

      .changes-table tbody tr:hover {
        background: #f1f3f4;
      }

      .changes-table .timestamp {
        white-space: nowrap;
        color: #6c757d;
        font-size: 13px;
      }

      .changes-table .preset {
        font-weight: 600;
        color: #495057;
      }

      .changes-table .changes {
        max-width: 400px;
      }

      .change-item {
        background: white;
        padding: 6px 10px;
        margin: 2px 0;
        border-radius: 3px;
        border-left: 3px solid #2196f3;
        font-size: 13px;
        line-height: 1.4;
      }

      @media (max-width: 768px) {
        .changes-table-container {
          overflow-x: auto;
        }

        .changes-table {
          min-width: 600px;
        }

        .changes-table th,
        .changes-table td {
          padding: 8px 10px;
          font-size: 12px;
        }
      }

      .config-section {
        margin: 20px 0;
      }

      .config-section h3 {
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
      }

      /* Methods List Styles */
      .methods-list {
        margin-top: 15px;
      }

      .method-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
        margin-bottom: 8px;
      }

      .method-name {
        font-weight: 600;
        color: #555;
      }

      .method-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .method-status {
        font-size: 12px;
        padding: 2px 8px;
        border-radius: 12px;
      }

      .method-status.enabled {
        background: #4caf50;
        color: white;
      }

      .method-status.disabled {
        background: #f44336;
        color: white;
      }

      /* Method Switch Styles */
      .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 20px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #2196f3;
      }

      input:checked + .slider:before {
        transform: translateX(20px);
      }

      /* Tab Styles */
      .tab-container {
        margin: 25px 0;
        background: white;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        overflow: hidden;
      }

      .tab-buttons {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
        padding: 0 20px;
      }

      .tab-button {
        padding: 16px 24px;
        border: none;
        background: none;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        color: #666;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .tab-button.active {
        border-bottom-color: #2196f3;
        color: #2196f3;
        font-weight: 600;
        background: white;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      }

      .tab-button:hover:not(.active) {
        color: #2196f3;
        background: rgba(33, 150, 243, 0.05);
      }

      .tab-content {
        display: none;
        padding: 30px;
        background: white;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Backup Management Styles */
      .backup-section {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #2196f3;
      }

      .backup-section h4 {
        margin: 0 0 15px 0;
        color: #333;
      }

      .backup-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .backup-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-bottom: 10px;
      }

      .backup-info {
        flex: 1;
      }

      .backup-name {
        font-weight: 600;
        color: #333;
        margin: 0 0 5px 0;
      }

      .backup-details {
        font-size: 12px;
        color: #666;
      }

      .backup-actions {
        display: flex;
        gap: 10px;
      }

      .backup-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
      }

      .backup-btn.restore {
        background: #4caf50;
        color: white;
      }

      .backup-btn.delete {
        background: #f44336;
        color: white;
      }

      .backup-btn.view {
        background: #2196f3;
        color: white;
      }

      .backup-btn:hover {
        opacity: 0.9;
      }

      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        resize: vertical;
      }

      textarea:focus {
        outline: none;
        border-color: #2196f3;
      }

      /* History Management Styles */
      .history-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .history-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .history-item {
        padding: 15px;
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        margin-bottom: 10px;
      }

      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .history-timestamp {
        font-size: 12px;
        color: #666;
      }

      .history-action {
        font-weight: 600;
        color: #333;
      }

      .history-details {
        font-size: 12px;
        color: #555;
        background: white;
        padding: 10px;
        border-radius: 4px;
      }

      .history-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .history-btn {
        padding: 4px 8px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 11px;
      }

      .history-btn.view {
        background: #2196f3;
        color: white;
      }

      .history-btn.rollback {
        background: #ff9800;
        color: white;
      }

      /* Tree Structure Styles */
      .tree-container {
        margin: 25px 0;
        background: white;
        border-radius: 8px;
        padding: 0;
      }

      .tree-node {
        margin: 0;
      }

      .tree-header {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-bottom: 1px solid #f0f0f0;
      }

      .tree-header:hover {
        background: #f8f9fa;
      }

      .tree-header.expanded {
        background: #f8f9fa;
      }

      .tree-header.collapsed {
        background: transparent;
      }

      .tree-toggle {
        margin-right: 10px;
        font-size: 16px;
        font-weight: bold;
        color: #666;
        transition: transform 0.3s ease;
      }

      .tree-toggle.expanded {
        /* Rotate handled by ::before to avoid double rotation */
        color: #4caf50;
      }

      .tree-title {
        flex: 1;
        font-weight: 600;
        color: #333;
        font-size: 16px;
      }

      .tree-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-right: 10px;
      }

      .tree-status.enabled {
        background: #4caf50;
        color: white;
      }

      .tree-status.disabled {
        background: #f44336;
        color: white;
      }

      .tree-content {
        margin-left: 35px;
        padding: 20px;
        background: transparent;
        display: none;
      }

      .tree-content.expanded {
        display: block;
      }

      .tree-methods {
        margin-top: 20px;
      }

      .method-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        background: transparent;
        border: none;
        margin-bottom: 8px;
        transition: all 0.3s ease;
      }

      .method-item:hover {
        background: #f8f9fa;
      }

      .method-name {
        font-weight: 500;
        color: #555;
      }

      .method-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .method-status {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
      }

      .method-status.enabled {
        background: #e8f5e8;
        color: #2e7d32;
      }

      .method-status.disabled {
        background: #ffebee;
        color: #c62828;
      }

      .tree-controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
      }

      .tree-search {
        margin-bottom: 25px;
        position: relative;
      }

      .tree-search input {
        width: 100%;
        padding: 12px 45px 12px 20px;
        border: 1px solid #e0e0e0;
        border-radius: 25px;
        font-size: 14px;
        background: white;
        transition: all 0.3s ease;
      }

      .tree-search input:focus {
        outline: none;
        border-color: #2196f3;
        transform: translateY(-1px);
      }

      .search-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-size: 16px;
      }

      .tree-filter {
        display: flex;
        gap: 12px;
        margin-bottom: 25px;
      }

      .filter-btn {
        padding: 8px 16px;
        border: 1px solid #e0e0e0;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .filter-btn.active {
        background: #2196f3;
        color: white;
        border-color: #2196f3;
        transform: translateY(-1px);
      }

      .filter-btn:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
      }

      /* Configuration Preview Styles */
      .config-summary {
        background: white;
        border-radius: 8px;
        padding: 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .config-section {
        border-bottom: 1px solid #e9ecef;
        padding: 20px;
      }

      .config-section:last-child {
        border-bottom: none;
      }

      .config-section h4 {
        margin: 0 0 15px 0;
        color: #495057;
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .config-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #007bff;
      }

      .config-label {
        font-weight: 600;
        color: #495057;
        min-width: 120px;
      }

      .config-value {
        color: #6c757d;
        font-family: "Courier New", monospace;
        font-size: 13px;
        word-break: break-all;
      }

      .modules-summary {
        margin-top: 10px;
      }

      .modules-stats {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .stat-label {
        font-size: 12px;
        color: #6c757d;
        font-weight: 500;
      }

      .stat-value {
        font-size: 18px;
        font-weight: 700;
        padding: 4px 12px;
        border-radius: 20px;
      }

      .stat-value.enabled {
        background: #d4edda;
        color: #155724;
      }

      .stat-value.disabled {
        background: #f8d7da;
        color: #721c24;
      }

      .stat-value.total {
        background: #d1ecf1;
        color: #0c5460;
      }

      .modules-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .module-tag {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid;
      }

      .module-tag.enabled {
        background: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
      }

      .module-tag.disabled {
        background: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }

      .raw-json {
        margin-top: 15px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        max-height: 400px;
        overflow-y: auto;
      }

      .raw-json pre {
        margin: 0;
        font-size: 12px;
        line-height: 1.3;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #f5c6cb;
        font-weight: 500;
      }

      .empty-config {
        background: #e2e3e5;
        color: #383d41;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #d6d8db;
        text-align: center;
        font-style: italic;
      }

      /* Tip System Styles */
      .tip-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 400px;
        transition: all 0.3s ease;
      }

      .tip {
        background: white;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        border-left: 4px solid;
        animation: slideInRight 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .tip::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: inherit;
      }

      .tip.info {
        border-left-color: #17a2b8;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      }

      .tip.success {
        border-left-color: #28a745;
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      }

      .tip.warning {
        border-left-color: #ffc107;
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      }

      .tip.error {
        border-left-color: #dc3545;
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      }

      .tip-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .tip-icon {
        font-size: 18px;
        font-weight: bold;
      }

      .tip-title {
        font-weight: 600;
        font-size: 14px;
        margin: 0;
      }

      .tip-content {
        font-size: 13px;
        line-height: 1.4;
        color: #495057;
        margin: 0;
      }

      .tip-close {
        position: absolute;
        top: 12px;
        right: 12px;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #6c757d;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .tip-close:hover {
        background: rgba(0, 0, 0, 0.1);
        color: #495057;
      }

      .tip-fade-out {
        animation: slideOutRight 0.3s ease forwards;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }

        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }

        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      /* Module Configuration Section Styles */
      .module-config-section {
        margin-top: 30px;
        padding: 25px;
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        border: 1px solid #f1f3f4;
      }

      .module-config-section h3 {
        margin: 0 0 20px 0;
        font-size: 20px;
        font-weight: 600;
        color: #2c3e50;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 10px;
      }

      .module-controls {
        display: flex;
        flex-wrap: nowrap;
        gap: 15px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding: 0;
        background: transparent;
        border: none;
      }

      .module-controls .tree-search {
        flex: 1;
        min-width: 300px;
        max-width: 450px;
        margin: 0;
      }

      .module-controls .tree-filter {
        display: flex;
        gap: 8px;
        margin: 0;
        white-space: nowrap;
        flex: none;
        min-width: auto;
        justify-content: flex-end;
        align-items: center;
      }

      /* Enhanced Tree Container Styles */
      .tree-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid #e9ecef;
        min-height: 400px;
      }

      /* Enhanced Tree Node Styles */
      .tree-node {
        margin: 8px 0;
        border-radius: 6px;
        background: #ffffff;
        border: 1px solid #e9ecef;
        overflow: hidden;
      }

      .tree-header {
        padding: 12px 16px;
        background: #f8f9fa;
        color: #2c3e50;
        border-radius: 6px 6px 0 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid #e9ecef;
      }

      .tree-toggle {
        font-size: 16px;
        font-weight: bold;
        min-width: 18px;
        text-align: center;
      }

      .tree-title {
        font-weight: 600;
        font-size: 14px;
        flex: 1;
      }

      .tree-status {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
        background: #e9ecef;
        border: 1px solid #dee2e6;
      }

      .tree-content {
        margin-left: 0;
        padding: 16px;
        background: white;
      }

      .method-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        margin: 6px 0;
        background: #f8f9fa;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      }

      .method-info {
        flex: 1;
      }

      .method-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 2px;
        font-size: 13px;
      }

      .method-description {
        font-size: 11px;
        color: #6c757d;
        line-height: 1.3;
      }

      .method-controls {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Tip System Responsive */
      @media (max-width: 768px) {
        .tip-container {
          left: 10px;
          right: 10px;
          max-width: none;
          top: 10px;
        }

        .tip {
          padding: 12px;
        }

        .history-controls {
          grid-template-columns: 1fr;
        }

        .tree-header {
          padding: 10px;
        }

        .tree-content {
          margin-left: 20px;
          padding: 10px;
        }

        .method-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .method-controls {
          align-self: flex-end;
        }

        /* Mobile responsive for module config */
        .module-config-section {
          padding: 15px;
          margin-top: 20px;
        }

        .module-controls {
          flex-direction: column;
          gap: 15px;
          padding: 0;
        }

        .module-controls .tree-search {
          flex: none;
          min-width: auto;
          max-width: none;
          width: 100%;
        }

        .module-controls .tree-filter {
          flex: none;
          width: 100%;
          justify-content: center;
          gap: 8px;
          min-width: auto;
        }

        .module-controls .tree-filter .filter-btn {
          flex: 1;
          min-width: 100px;
          max-width: 150px;
        }

        .tree-container {
          padding: 15px;
        }
      }
      /* Language Switcher - Segmented Toggle */
      .language-switcher {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 12px;
        margin: 8px 0 12px;
      }
      .language-switcher .lang-label {
        color: #6c757d;
        font-size: 13px;
      }
      .segmented-toggle {
        display: inline-flex;
        border: 1px solid #e0e0e0;
        border-radius: 999px;
        background: #fff;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      }
      .segmented-toggle .toggle-option {
        padding: 6px 12px;
        font-size: 13px;
        font-weight: 600;
        border: none;
        background: transparent;
        cursor: pointer;
        color: #546e7a;
        transition: background-color 0.2s ease, color 0.2s ease;
      }
      .segmented-toggle .toggle-option.active {
        background: #2196f3;
        color: #fff;
      }
      .segmented-toggle .toggle-option:not(.active):hover {
        background: #f1f5f9;
      }
      .segmented-toggle .toggle-option:focus-visible {
        outline: 2px solid #90caf9;
        outline-offset: 2px;
        border-radius: 999px;
      }

      /* Body Configuration Styles */
      .body-container {
        margin: 10px 0;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 12px;
        background: #f8f9fa;
        max-height: 200px;
        overflow-y: auto;
      }

      .body-pair {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
        padding: 8px;
        background: white;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      }

      .body-pair:last-child {
        margin-bottom: 0;
      }

      .body-pair .body-key {
        flex: 1;
        min-width: 120px;
      }

      .body-pair .body-value {
        flex: 2;
        min-width: 200px;
      }

      .body-pair .remove-body {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        width: 30px;
        height: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
      }

      .body-pair .remove-body:hover {
        background: #c82333;
      }

      .add-body-btn {
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 8px;
        transition: background-color 0.2s ease;
      }

      .add-body-btn:hover {
    background: #218838;
  }

  /* Token Extraction Styles */
  .token-extraction-container {
    margin: 10px 0;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 12px;
    background: #f8f9fa;
    max-height: 200px;
    overflow-y: auto;
  }

  .token-extraction-pair {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    padding: 8px;
    background: white;
    border-radius: 4px;
    border: 1px solid #e9ecef;
  }

  .token-extraction-pair:last-child {
    margin-bottom: 0;
  }

  .extraction-source,
  .extraction-key,
  .extraction-format,
  .extraction-target,
  .extraction-target-key {
    flex: 1;
  }

  .extraction-source label,
  .extraction-key label,
  .extraction-format label,
  .extraction-target label,
  .extraction-target-key label {
    display: block;
    font-size: 11px;
    color: #666;
    margin-bottom: 2px;
  }

  .remove-token-extraction {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 4px;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
  }

  .remove-token-extraction:hover {
    background: #c82333;
  }

  .add-token-extraction-btn {
    background: #2196F3;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 8px;
    transition: background-color 0.2s ease;
  }

  .add-token-extraction-btn:hover {
    background: #1976D2;
  }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 data-i18n="title_main">MCP-ANY-REST Configuration</h1>

      <div class="language-switcher" aria-label="Language Switcher">
        <span class="lang-label" data-i18n="label_language">Language:</span>
        <div class="segmented-toggle" role="tablist" aria-label="Language">
          <button
            type="button"
            class="toggle-option"
            data-lang="en"
            aria-selected="false"
          >
            EN
          </button>
          <button
            type="button"
            class="toggle-option"
            data-lang="zh"
            aria-selected="false"
          >
            中文
          </button>
        </div>
      </div>

      <div class="tab-container">
        <div class="tab-buttons">
          <button
            class="tab-button active"
            onclick="showTab('presets')"
            data-i18n="tab_presets"
          >
            Preset Configuration
          </button>
          <button
            class="tab-button"
            onclick="showTab('config-json')"
            data-i18n="tab_config_json"
          >
            Config.json Settings
          </button>
        </div>

        <div id="presets" class="tab-content active">
          <h3 data-i18n="section_config_presets">Configuration Presets</h3>

          <div class="action-buttons" style="margin-bottom: 20px">
            <button
              class="btn btn-primary"
              onclick="reloadConfig()"
              data-i18n="btn_reload_file"
            >
              Reload from File
            </button>
            <button
              class="btn btn-success"
              onclick="saveConfig()"
              data-i18n="btn_save_file"
            >
              Save to File
            </button>
            <button
              class="btn btn-info"
              onclick="openSavePresetModal()"
              data-i18n="btn_save_as_preset"
            >
              Save as Preset
            </button>
          </div>

          <!-- Save Preset Modal -->
          <div id="savePresetModal" class="modal" style="display: none">
            <div class="modal-content">
              <div class="modal-header">
                <h3 data-i18n="modal_save_preset_title">
                  Save Current Configuration as Preset
                </h3>
                <span class="close" onclick="closeSavePresetModal()"
                  >&times;</span
                >
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="preset-name-input" data-i18n="label_preset_name"
                    >Preset Name:</label
                  >
                  <input
                    type="text"
                    id="preset-name-input"
                    data-i18n-placeholder="placeholder_preset_name"
                    placeholder="Enter preset name (e.g., custom-config)"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="preset-description-input"
                    data-i18n="label_description"
                    >Description:</label
                  >
                  <textarea
                    id="preset-description-input"
                    data-i18n-placeholder="placeholder_preset_description"
                    placeholder="Enter preset description"
                    rows="3"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="preset-id-input" data-i18n="label_preset_id"
                    >Preset ID (optional):</label
                  >
                  <input
                    type="text"
                    id="preset-id-input"
                    data-i18n-placeholder="placeholder_preset_id"
                    placeholder="Leave empty for auto-generated ID"
                  />
                </div>
                <div class="preset-preview">
                  <h4 data-i18n="preset_preview_title">
                    Configuration Preview:
                  </h4>
                  <div
                    id="preset-preview-content"
                    class="tree-container"
                    style="max-height: 300px; overflow-y: auto"
                  ></div>
                </div>
              </div>
              <div class="modal-footer">
                <button
                  class="btn btn-secondary"
                  onclick="closeSavePresetModal()"
                  data-i18n="btn_cancel"
                >
                  Cancel
                </button>
                <button
                  class="btn btn-primary"
                  onclick="savePreset()"
                  data-i18n="btn_save_preset"
                >
                  Save Preset
                </button>
              </div>
            </div>
          </div>

          <!-- Preset Management Section -->
          <div class="preset-management-section" style="margin-top: 30px">
            <h3 data-i18n="section_preset_management">Preset Management</h3>
            <div
              class="preset-list"
              id="preset-list"
              style="max-height: 300px; overflow-y: auto"
            >
              <p data-i18n="loading_presets">Loading presets...</p>
            </div>
          </div>

          <div class="module-config-section">
            <h3 data-i18n="section_module_details">
              Module Configuration Details
            </h3>

            <!-- Tree Search and Filter Controls -->
            <div class="module-controls">
              <div class="tree-search">
                <input
                  type="text"
                  id="module-search"
                  placeholder="Search modules and methods..."
                  data-i18n-placeholder="placeholder_search_modules"
                  oninput="filterTree()"
                />
                <span class="search-icon">🔍</span>
              </div>

              <div class="tree-filter">
                <button
                  class="filter-btn active"
                  onclick="setTreeFilter('all')"
                  data-i18n="filter_all_modules"
                >
                  All Modules
                </button>
                <button
                  class="filter-btn"
                  onclick="setTreeFilter('enabled')"
                  data-i18n="filter_enabled_only"
                >
                  Enabled Only
                </button>
                <button
                  class="filter-btn"
                  onclick="setTreeFilter('disabled')"
                  data-i18n="filter_disabled_only"
                >
                  Disabled Only
                </button>
              </div>
            </div>

            <!-- Tree Structure Container -->
            <div class="tree-container" id="module-tree">
              <p data-i18n="loading_module_config">
                Loading module configuration...
              </p>
            </div>
          </div>
        </div>

        <div id="config-json" class="tab-content">
          <h3 data-i18n="section_config_json">Config.json Settings</h3>
          <div class="action-buttons" style="margin-bottom: 20px">
            <button
              class="btn btn-primary"
              onclick="loadServerConfig()"
              data-i18n="btn_load_config"
            >
              Load Config
            </button>
            <button
              class="btn btn-success"
              onclick="saveEnhancedConfig()"
              data-i18n="btn_save_config"
            >
              Save Config
            </button>
            <button
              class="btn btn-info"
              onclick="resetToDefault()"
              data-i18n="btn_reset_default"
            >
              Reset to Default
            </button>
          </div>

          <!-- Enhanced Configuration Editor -->
          <div class="config-editor-container">
            <div class="config-sections">
              <!-- Server Configuration Section -->
              <div class="config-section" id="server-config">
                <div
                  class="section-header"
                  onclick="toggleSection('server-config')"
                >
                  <h4 data-i18n="section_server_config">Server Configuration</h4>
                  <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                  <div class="form-group">
                    <label for="server_port" data-i18n="label_server_port">Server Port:</label>
                    <input
                      type="number"
                      id="server_port"
                      class="config-input"
                      value="3000"
                      min="1024"
                      max="65535"
                    />
                  </div>
                  <div class="form-group">
                    <label for="log_level" data-i18n="label_log_level">Log Level:</label>
                    <select id="log_level" class="config-select">
                      <option value="error" data-i18n="log_error">Error</option>
                      <option value="warn" data-i18n="log_warn">Warn</option>
                      <option value="info" data-i18n="log_info" selected>Info</option>
                      <option value="debug" data-i18n="log_debug">Debug</option>
                      <option value="trace" data-i18n="log_trace">Trace</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="max_connections" data-i18n="label_max_connections">Max Connections:</label>
                    <input
                      type="number"
                      id="max_connections"
                      class="config-input"
                      value="100"
                      min="1"
                      max="1000"
                    />
                  </div>
                </div>
              </div>

              <!-- API Configuration Section -->
              <div class="config-section" id="api-config">
                <div
                  class="section-header"
                  onclick="toggleSection('api-config')"
                >
                  <h4 data-i18n="section_api_config">API Configuration</h4>
                  <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                  <div class="form-group">
                    <label for="base_url" data-i18n="label_base_url">Base URL:</label>
                    <input
                      type="text"
                      id="base_url"
                      class="config-input"
                      value="https://119.96.179.118:8081/zentao/api.php/v1"
                      placeholder="https://your-api-server.com/api"
                      data-i18n-placeholder="placeholder_base_url"
                    />
                  </div>
                  <div class="form-group">
                    <label for="timeout" data-i18n="label_timeout">Timeout (seconds):</label>
                    <input
                      type="number"
                      id="timeout"
                      class="config-input"
                      value="30"
                      min="1"
                      max="300"
                    />
                  </div>
                  <div class="form-group">
                    <label for="retry_attempts" data-i18n="label_retry_attempts">Retry Attempts:</label>
                    <input
                      type="number"
                      id="retry_attempts"
                      class="config-input"
                      value="3"
                      min="0"
                      max="10"
                    />
                  </div>
                  <div class="form-group">
                    <label for="rate_limit" data-i18n="label_rate_limit">Rate Limit (requests/min):</label>
                    <input
                      type="number"
                      id="rate_limit"
                      class="config-input"
                      value="60"
                      min="1"
                      max="1000"
                    />
                  </div>
                </div>
              </div>

              <!-- Authentication Configuration Section -->
              <div class="config-section" id="auth-config">
                <div
                  class="section-header"
                  onclick="toggleSection('auth-config')"
                >
                  <h4 data-i18n="section_auth_config">Authentication Configuration</h4>
                  <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                  <!-- Global Authentication Settings -->
                  <div class="form-group">
                    <h5 data-i18n="subsection_global_auth">Global Authentication Settings</h5>
                    <div class="form-group">
                      <label for="auth_mode" data-i18n="label_auth_mode">Authentication Mode:</label>
                      <select
                        id="auth_mode"
                        class="config-select"
                        onchange="toggleAuthConfig()"
                      >
                        <option value="direct" data-i18n="auth_direct_authentication">Direct Authentication</option>
                        <option value="login" data-i18n="auth_login_authentication">Login Authentication</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="token_expiry" data-i18n="label_token_expiry_time">Token Expiry (seconds):</label>
                      <input
                        type="number"
                        id="token_expiry"
                        class="config-input"
                        value="3600"
                        min="60"
                        max="86400"
                      />
                    </div>
                    <div class="form-group">
                      <label for="refresh_buffer" data-i18n="label_token_refresh_buffer">Refresh Buffer (seconds):</label>
                      <input
                        type="number"
                        id="refresh_buffer"
                        class="config-input"
                        value="300"
                        min="0"
                        max="3600"
                      />
                    </div>
                    <div class="form-group">
                      <label for="max_retry_attempts" data-i18n="label_max_retry_attempts">Max Retry Attempts:</label>
                      <input
                        type="number"
                        id="max_retry_attempts"
                        class="config-input"
                        value="3"
                        min="0"
                        max="10"
                      />
                    </div>
                  </div>

                  <!-- Direct Authentication Configuration -->
                  <div id="direct-auth-config" class="auth-subsection">
                    <h5 data-i18n="subsection_direct_auth">Direct Authentication</h5>
                    <div class="form-group">
                      <label for="direct_auth_type" data-i18n="label_direct_auth_type">Auth Type:</label>
                      <select id="direct_auth_type" class="config-select">
                        <option value="bearer" data-i18n="option_bearer_token">Bearer Token</option>
                        <option value="api_key" data-i18n="option_api_key">API Key</option>
                        <option value="basic" data-i18n="option_basic_auth">Basic Auth</option>
                        <option value="token" data-i18n="option_token">Token</option>
                        <option value="custom_headers" data-i18n="option_custom_headers">Custom Headers</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="auth_token" data-i18n="label_login_token_key">Token/Key:</label>
                      <input
                        type="password"
                        id="auth_token"
                        class="config-input"
                        placeholder="Enter authentication token"
                        data-i18n-placeholder="placeholder_auth_token"
                      />
                    </div>
                    <div class="form-group">
                      <label for="api_key_name" data-i18n="label_api_key_name">API Key Name:</label>
                      <input
                        type="text"
                        id="api_key_name"
                        class="config-input"
                        placeholder="X-API-Key"
                        data-i18n-placeholder="placeholder_api_key_name"
                      />
                    </div>
                    <div class="form-group">
                      <label for="username" data-i18n="label_username">Username:</label>
                      <input
                        type="text"
                        id="username"
                        class="config-input"
                        placeholder="Enter username"
                        data-i18n-placeholder="placeholder_username"
                      />
                    </div>
                    <div class="form-group">
                      <label for="password" data-i18n="label_password">Password:</label>
                      <input
                        type="password"
                        id="password"
                        class="config-input"
                        placeholder="Enter password"
                        data-i18n-placeholder="placeholder_password"
                      />
                    </div>
                    <!-- Custom Headers Configuration -->
                    <div id="custom-headers-config" class="form-group" style="display: none;">
                      <label data-i18n="label_custom_headers">Custom Headers:</label>
                      <div id="custom-headers-container">
                        <div class="header-pair">
                          <input type="text" class="header-key config-input" placeholder="Header Name" data-i18n-placeholder="placeholder_header_name" />
                          <input type="text" class="header-value config-input" placeholder="Header Value" data-i18n-placeholder="placeholder_header_value" />
                          <button type="button" class="remove-header-btn" onclick="removeHeader(this)">-</button>
                        </div>
                      </div>
                      <button type="button" class="add-header-btn" onclick="addHeader()" data-i18n="btn_add_header">+ Add Header</button>
                    </div>
                  </div>

                  <!-- Login Authentication Configuration -->
                  <div
                    id="login-auth-config"
                    class="auth-subsection"
                    style="display: none"
                  >
                    <h5 data-i18n="subsection_login_auth">Login Authentication</h5>
                    
                    <!-- Basic Configuration -->
                    <div class="form-group">
                      <label for="login_url" data-i18n="label_login_url">Login URL:</label>
                      <input
                        type="text"
                        id="login_url"
                        class="config-input"
                        placeholder="https://your-server.com/login"
                        data-i18n-placeholder="placeholder_login_url"
                      />
                    </div>
                    <div class="form-group">
                      <label for="login_method" data-i18n="label_http_method">HTTP Method:</label>
                      <select id="login_method" class="config-select">
                        <option value="POST" data-i18n="http_post">POST</option>
                        <option value="GET" data-i18n="http_get">GET</option>
                        <option value="PUT" data-i18n="http_put">PUT</option>
                        <option value="DELETE" data-i18n="http_delete">DELETE</option>
                        <option value="PATCH" data-i18n="http_patch">PATCH</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="login_auth_type" data-i18n="label_request_body_type">Request Body Type:</label>
                      <select id="login_auth_type" class="config-select">
                        <option value="json" data-i18n="body_type_json">JSON</option>
                        <option value="form" data-i18n="body_type_form">Form Data</option>
                        <option value="oauth2" data-i18n="body_type_oauth2">OAuth2</option>
                        <option value="api_key" data-i18n="body_type_api_key">API Key</option>
                        <option value="custom" data-i18n="body_type_custom">Custom</option>
                      </select>
                    </div>
                    
                    <!-- Headers Configuration -->
                    <div class="form-group">
                      <label data-i18n="label_request_headers">Request Headers:</label>
                      <div id="login-headers-container" class="headers-container">
                        <div class="header-pair">
                          <input type="text" class="header-key config-input" placeholder="Header Key" value="Content-Type" data-i18n-placeholder="placeholder_header_name">
                          <input type="text" class="header-value config-input" placeholder="Header Value" value="application/json" data-i18n-placeholder="placeholder_header_value">
                          <button type="button" class="remove-header" onclick="removeHeader(this)">×</button>
                        </div>
                      </div>
                      <button type="button" class="add-header-btn" onclick="addLoginHeader()" data-i18n="btn_add_header">Add Header</button>
                    </div>
                    
                    <!-- Request Body Configuration -->
                    <div class="form-group">
                      <label data-i18n="label_request_body">Request Body:</label>
                      <div id="login-body-container" class="body-container">
                        <div class="body-pair">
                          <input type="text" class="body-key config-input" placeholder="Parameter Key" value="username" data-i18n-placeholder="placeholder_param_key">
                          <input type="text" class="body-value config-input" placeholder="Parameter Value" value="" data-i18n-placeholder="placeholder_param_value">
                          <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
                        </div>
                        <div class="body-pair">
                          <input type="text" class="body-key config-input" placeholder="Parameter Key" value="password" data-i18n-placeholder="placeholder_param_key">
                          <input type="text" class="body-value config-input" placeholder="Parameter Value" value="" data-i18n-placeholder="placeholder_param_value">
                          <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
                        </div>
                      </div>
                      <button type="button" class="add-body-btn" onclick="addLoginBody()" data-i18n="btn_add_parameter">Add Parameter</button>
                    </div>
                    
                    <!-- Response Configuration -->
                    <div class="form-group">
                      <label for="response_format" data-i18n="label_response_format">Response Format:</label>
                      <select id="response_format" class="config-select">
                        <option value="json" data-i18n="response_json">JSON</option>
                        <option value="xml" data-i18n="response_xml">XML</option>
                        <option value="text" data-i18n="response_text">Text</option>
                      </select>
                    </div>
                    
                    <!-- Token Extraction Configuration -->
                    <div class="form-group">
                      <label data-i18n="label_token_extraction">Token Extraction:</label>
                      <div id="token-extraction-container" class="token-extraction-container">
                        <div class="token-extraction-pair">
                          <div class="extraction-source">
                            <label data-i18n="label_source_location">Source Location:</label>
                            <select class="source-location config-select">
                              <option value="body" data-i18n="response_body">Response Body</option>
                              <option value="header" data-i18n="response_header">Response Header</option>
                            </select>
                          </div>
                          <div class="extraction-key">
                            <label data-i18n="label_token_key">Token Key:</label>
                            <input type="text" class="token-key config-input" placeholder="token" value="token" data-i18n-placeholder="placeholder_token_key" />
                          </div>
                          <div class="extraction-format">
                            <label data-i18n="label_token_format">Token Format:</label>
                            <select class="token-format config-select">
                              <option value="bearer" data-i18n="token_format_bearer">Bearer</option>
                              <option value="raw" data-i18n="token_format_raw">Raw</option>
                            </select>
                          </div>
                          <div class="extraction-target">
                            <label data-i18n="label_target_location">Target Location:</label>
                            <select class="target-location config-select">
                              <option value="header" data-i18n="request_header">Request Header</option>
                              <option value="body" data-i18n="request_body">Request Body</option>
                            </select>
                          </div>
                          <div class="extraction-target-key">
                            <label data-i18n="label_target_key">Target Key:</label>
                            <input type="text" class="target-key config-input" placeholder="Authorization" value="Authorization" data-i18n-placeholder="placeholder_target_key" />
                          </div>
                          <button type="button" class="remove-token-extraction" onclick="removeTokenExtraction(this)">×</button>
                        </div>
                      </div>
                      <button type="button" class="add-token-extraction-btn" onclick="addTokenExtraction()" data-i18n="btn_add_token_extraction">Add Token Extraction</button>
                    </div>
                    
                    <!-- Token Refresh Configuration -->
                    <div class="form-group">
                      <label for="refresh_url" data-i18n="label_refresh_url">Refresh URL (optional):</label>
                      <input
                        type="text"
                        id="refresh_url"
                        class="config-input"
                        placeholder="https://your-server.com/refresh"
                        data-i18n-placeholder="placeholder_refresh_url"
                      />
                    </div>
                    <div class="form-group">
                      <label for="refresh_method" data-i18n="label_refresh_method">Refresh Method (optional):</label>
                      <select id="refresh_method" class="config-select">
                        <option value="" data-i18n="http_none">None</option>
                        <option value="POST" data-i18n="http_post">POST</option>
                        <option value="GET" data-i18n="http_get">GET</option>
                        <option value="PUT" data-i18n="http_put">PUT</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Module Configuration Section -->
              <div class="config-section" id="module-config">
                <div
                  class="section-header"
                  onclick="toggleSection('module-config')"
                >
                  <h4 data-i18n="section_module_configuration">Module Configuration</h4>
                  <span class="section-toggle">▼</span>
                </div>
                <div class="section-content">
                  <!-- Global Module Settings -->
                  <div class="form-group">
                    <h5 data-i18n="section_global_module_settings">Global Module Settings</h5>
                    <div class="form-group">
                      <label for="default_access_level" data-i18n="label_default_access_level">Default Access Level:</label>
                      <select id="default_access_level" class="config-select">
                        <option value="internal" data-i18n="access_internal">Internal</option>
                        <option value="public" data-i18n="access_public">Public</option>
                        <option value="private" data-i18n="access_private">Private</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="default_rate_limit" data-i18n="label_default_rate_limit">Default Rate Limit (requests/min):</label>
                      <input
                        type="number"
                        id="default_rate_limit"
                        class="config-input"
                        value="60"
                        min="1"
                        max="1000"
                      />
                    </div>
                  </div>

                  <!-- Module Management options removed: modules_enabled, auto_discover_modules, module_cache_ttl -->
                </div>
              </div>

            </div>
          </div>

          <!-- Configuration Explorer removed -->

          <div
            class="status-message"
            id="config-json-status"
            style="margin-top: 20px"
          ></div>
        </div>
      </div>

      <div id="status" class="status"></div>

      <!-- Tip System Container -->
      <div id="tip-container" class="tip-container"></div>

      <script>
        let modulesData = [];
        let presetsData = [];
        let tipQueue = [];
        let currentTipId = 0;

        // I18n setup
        let currentLang = localStorage.getItem("language") || "en";
        const i18n = {
          en: {
            // Header & Tabs
            title_main: "MCP-ANY-REST Configuration",
            label_language: "Language:",
            tab_presets: "Preset Configuration",
            tab_config_json: "Config.json Settings",
            tab_preview: "Configuration Preview",
            // Presets section
            section_config_presets: "Configuration Presets",
            btn_reload_file: "Reload from File",
            btn_save_file: "Save to File",
            btn_save_as_preset: "Save as Preset",
            modal_save_preset_title: "Save Current Configuration as Preset",
            label_preset_name: "Preset Name:",
            placeholder_preset_name: "Enter preset name (e.g., custom-config)",
            label_description: "Description:",
            placeholder_preset_description: "Enter preset description",
            label_preset_id: "Preset ID (optional):",
            placeholder_preset_id: "Leave empty for auto-generated ID",
            preset_preview_title: "Configuration Preview:",
            btn_cancel: "Cancel",
            btn_save_preset: "Save Preset",
            section_preset_management: "Preset Management",
            loading_presets: "Loading presets...",
            // Modules section
            section_module_configuration: "Module Configuration",
            section_global_module_settings: "Global Module Settings",
            label_default_access_level: "Default Access Level:",
            label_default_rate_limit: "Default Rate Limit (requests/min):",
            section_module_details: "Module Configuration Details",
            placeholder_search_modules: "Search modules and methods...",
            filter_all_modules: "All Modules",
            filter_enabled_only: "Enabled Only",
            filter_disabled_only: "Disabled Only",
            loading_module_config: "Loading module configuration...",
            // Config JSON
            section_config_json: "Config.json Settings",
            btn_load_config: "Load Config",
            btn_save_config: "Save Config",
            btn_reset_default: "Reset to Default",
            label_base_url: "Base URL:",
            placeholder_base_url: "https://your-zentao-instance.com",
            label_default_username: "Default Username:",
            placeholder_default_username: "admin",
            label_default_password: "Default Password:",
            placeholder_default_password: "password",
            label_auth_mode: "Authentication Mode:",
            auth_direct: "Direct",
            auth_login: "Login",
            direct_auth_config: "Direct Authentication Configuration",
            label_direct_auth_type: "Auth Type:",
            login_auth_config: "Login Authentication Configuration",
            label_login_auth_url: "Auth URL:",
            placeholder_login_auth_url: "https://your-instance.com/api/tokens",
            label_login_auth_method: "Auth Method:",
            label_login_auth_account: "Account:",
            placeholder_login_auth_account: "admin",
            label_login_auth_password: "Password:",
            placeholder_login_auth_password: "password",
            label_login_token_key: "Token Key:",
            placeholder_login_token_key: "token",
            label_server_port: "Server Port:",
            label_log_level: "Log Level:",
            label_token_refresh_buffer: "Token Refresh Buffer (seconds):",
            label_token_expiry_time: "Token Expiry Time (seconds):",
            label_max_retry_attempts: "Max Retry Attempts:",
            // Server/API/Auth sections
            section_server_config: "Server Configuration",
            section_api_config: "API Configuration",
            section_auth_config: "Authentication Configuration",
            subsection_global_auth: "Global Authentication Settings",
            auth_direct_authentication: "Direct Authentication",
            auth_login_authentication: "Login Authentication",
            // Log level options
            log_error: "Error",
            log_warn: "Warn",
            log_info: "Info",
            log_debug: "Debug",
            log_trace: "Trace",
            // Server config labels
            label_max_connections: "Max Connections:",
            // API config labels
            label_timeout: "Timeout (seconds):",
            label_retry_attempts: "Retry Attempts:",
            // Direct auth
            subsection_direct_auth: "Direct Authentication",
            option_bearer_token: "Bearer Token",
            option_api_key: "API Key",
            option_basic_auth: "Basic Auth",
            option_token: "Token",
            option_custom_headers: "Custom Headers",
            label_api_key_name: "API Key Name:",
            placeholder_api_key_name: "X-API-Key",
            placeholder_auth_token: "Enter authentication token",
            label_username: "Username:",
            placeholder_username: "Enter username",
            label_password: "Password:",
            placeholder_password: "Enter password",
            label_custom_headers: "Custom Headers:",
            placeholder_header_name: "Header Name",
            placeholder_header_value: "Header Value",
            btn_add_header: "Add Header",
            // Login auth
            subsection_login_auth: "Login Authentication",
            label_login_url: "Login URL:",
            placeholder_login_url: "https://your-server.com/login",
            label_http_method: "HTTP Method:",
            // HTTP methods
            http_none: "None",
            http_post: "POST",
            http_get: "GET",
            http_put: "PUT",
            http_delete: "DELETE",
            http_patch: "PATCH",
            // Login body type
            label_request_body_type: "Request Body Type:",
            body_type_json: "JSON",
            body_type_form: "Form Data",
            body_type_oauth2: "OAuth2",
            body_type_api_key: "API Key",
            body_type_custom: "Custom",
            // Login headers/body
            label_request_headers: "Request Headers:",
            label_request_body: "Request Body:",
            placeholder_param_key: "Parameter Key",
            placeholder_param_value: "Parameter Value",
        btn_add_parameter: "Add Parameter",
        // Token Extraction
        label_token_extraction: "Token Extraction",
        label_source_location: "Source Location",
        response_body: "Response Body",
        response_header: "Response Header",
        label_token_key: "Token Key",
        placeholder_token_key: "e.g. data.token or Authorization",
        label_token_format: "Token Format",
        token_format_bearer: "Bearer",
        token_format_raw: "Raw",
        label_target_location: "Target Location",
        request_header: "Request Header",
        request_body: "Request Body",
        label_target_key: "Target Key",
        placeholder_target_key: "e.g. Authorization or body.token",
        btn_add_token_extraction: "Add Token Extraction",
            // Response format
            label_response_format: "Response Format:",
            response_json: "JSON",
            response_xml: "XML",
            response_text: "Text",
            // Refresh
            label_refresh_url: "Refresh URL (optional):",
            placeholder_refresh_url: "https://your-server.com/refresh",
            label_refresh_method: "Refresh Method (optional):",
            // Preview
            section_current_preview: "Current Configuration Preview",
            btn_refresh_preview: "Refresh Preview",
            text_loading: "Loading...",
            // Dynamic common
            no_description: "No description",
            btn_apply: "Apply",
            btn_delete: "Delete",
            no_presets:
              "No presets available. Create a new preset to get started.",
            error_loading_presets_prefix: "Error loading presets: ",
            error_loading_modules_prefix: "Error loading modules: ",
            // Module tree dynamic
            no_modules: "No modules available",
            status_enabled_symbol: "✓ Enabled",
            status_disabled_symbol: "✗ Disabled",
            methods_suffix: "methods",
            label_enabled: "Enabled:",
            label_access_level: "Access Level:",
            label_rate_limit: "Rate Limit (req/min):",
            access_internal: "Internal",
            access_public: "Public",
            access_private: "Private",
            methods_header: "Methods",
            status_enabled_label: "Enabled",
            status_disabled_label: "Disabled",
            no_methods: "No methods available",
            btn_save: "Save",
            btn_reset: "Reset",
            // Preset preview dynamic
            summary_enabled: "Enabled:",
            enabled_yes: "Yes",
            enabled_no: "No",
            summary_description: "Description:",
            summary_access_level: "Access Level:",
            summary_rate_limit: "Rate Limit:",
            req_per_min: "req/min",
            // Tip titles
            tip_info: "Information",
            tip_success: "Success",
            tip_warning: "Warning",
            tip_error: "Error",
            // Raw JSON
            raw_json_title: "Raw JSON Configuration",
            // Contextual tip titles
            tip_title_quick_setup: "Quick Setup",
            tip_title_module_search: "Module Search",
            tip_title_direct_editing: "Direct Editing",
            tip_title_preview: "Configuration Preview",
            tip_title_real_time_data: "Real-time Data",
            tip_title_auto_save: "Auto-save",
            // Contextual tip messages
            msg_select_preset_quick_apply:
              "Select a preset configuration to quickly apply common settings.",
            msg_search_filter_modules:
              "Use the search and filter options to find specific modules.",
            msg_edit_config_json_direct:
              "Edit the config.json file directly to make advanced changes.",
            msg_preview_structured_config:
              "This shows your current configuration in a structured format.",
            msg_click_refresh_preview:
              'Click "Refresh Preview" to get the latest configuration data.',
            msg_auto_save_server:
              "All changes are automatically saved to the server.",
            // Generic
            unknown_error: "Unknown error",
            // Tip titles for operations
            title_preset_applied: "Preset Applied",
            title_preset_application_failed: "Preset Application Failed",
            title_application_error: "Application Error",
            title_configuration_reloaded: "Configuration Reloaded",
            title_reload_failed: "Reload Failed",
            title_reload_error: "Reload Error",
            title_configuration_saved: "Configuration Saved",
            title_save_failed: "Save Failed",
            title_save_error: "Save Error",
            title_save_success: "Save Success",
            title_module_updated: "Module Updated",
            title_method_updated: "Method Updated",
            title_update_failed: "Update Failed",
            title_update_error: "Update Error",
            title_module_reset: "Module Reset",
            title_reset_failed: "Reset Failed",
            title_reset_error: "Reset Error",
            title_settings_updated: "Settings Updated",
            title_validation_error: "Validation Error",
            title_load_success: "Load Success",
            title_load_error: "Load Error",
            title_delete_success: "Delete Success",
            title_delete_error: "Delete Error",
            title_apply_success: "Apply Success",
            title_apply_error: "Apply Error",
            // Operation messages
            msg_preset_applied:
              "Configuration preset has been successfully applied to your system.",
            msg_failed_apply_selected:
              "Failed to apply the selected preset. Please try again.",
            msg_config_reset_to_default: "Configuration reset to default!",
            title_reset_success: "Reset Success",
            msg_failed_reset_configuration_prefix: "Failed to reset configuration: ",
            msg_error_resetting_configuration_prefix: "Error resetting configuration: ",
            msg_failed_save_configuration_prefix: "Failed to save configuration: ",
            msg_error_saving_configuration_prefix: "Error saving configuration: ",
            msg_error_applying_preset_prefix: "Error applying preset: ",
            msg_configuration_reloaded:
              "Configuration has been successfully reloaded from the configuration file.",
            msg_failed_reload_config:
              "Failed to reload configuration from file. Please check file permissions.",
            msg_error_reloading_config_prefix:
              "Error reloading configuration: ",
            msg_configuration_saved:
              "Configuration has been successfully saved to the configuration file.",
            msg_failed_save_config:
              "Failed to save configuration to file. Please check file permissions.",
            msg_error_saving_config_prefix: "Error saving configuration: ",
            msg_module_updated_fmt:
              'Module "{module}" has been successfully updated.',
            msg_failed_update_module_prefix_fmt:
              'Failed to update module "{module}": ',
            msg_error_updating_module_prefix:
              'Error updating module "{module}": ',
            msg_method_updated_fmt:
              'Method "{method}" in module "{module}" has been successfully updated.',
            msg_failed_update_method_retry:
              "Failed to update method. Please try again.",
            msg_error_updating_method_prefix:
              'Error updating method "{method}" in module "{module}": ',
            msg_module_config_saved_fmt:
              'Module "{module}" configuration has been successfully saved.',
            msg_failed_save_module_config_retry:
              "Failed to save module configuration. Please try again.",
            msg_error_saving_module_config_prefix:
              'Error saving module "{module}" configuration: ',
            msg_module_reset_fmt:
              'Module "{module}" has been successfully reset to default settings.',
            msg_failed_reset_module_retry:
              "Failed to reset module. Please try again.",
            msg_error_resetting_module_prefix:
              'Error resetting module "{module}": ',
            msg_advanced_updated:
              "Advanced settings have been successfully updated.",
            msg_failed_update_advanced_prefix:
              "Failed to update advanced settings: ",
            msg_error_update_advanced_prefix:
              "Error updating advanced settings: ",
            msg_server_config_loaded:
              "Server configuration loaded successfully.",
            msg_failed_load_server_config_prefix:
              "Failed to load server configuration. Status: ",
            msg_error_loading_server_config_prefix:
              "Error loading server configuration: ",
            validation_rate_limit_min:
              "Rate limit must be at least 1 request per minute",
            validation_rate_limit_max:
              "Rate limit cannot exceed 1000 requests per minute",
            validation_requests_per_minute_min:
              "Requests per minute must be a number greater than 0",
            validation_requests_per_minute_max:
              "Requests per minute cannot exceed 10000",
            validation_access_level_invalid:
              "Invalid access level. Must be Internal, Public, or Private",
            validation_enabled_boolean: "Enabled field must be a boolean value",
            validation_preset_required: "Preset ID and Name are required",
            validation_preset_id_format:
              "Preset ID can only contain letters, numbers, underscores and hyphens",
            msg_preset_saved_success: "Preset saved successfully!",
            msg_failed_save_configuration_prefix:
              "Failed to save configuration: ",
            msg_error_saving_configuration_prefix:
              "Error saving configuration: ",
            confirm_delete_preset:
              "Are you sure you want to delete this preset? This action cannot be undone.",
            msg_failed_delete_preset_prefix: "Failed to delete preset: ",
            msg_error_deleting_preset_prefix: "Error deleting preset: ",
            msg_preset_deleted_success: "Preset deleted successfully!",
            msg_failed_save_preset_prefix: "Failed to save preset: ",
            msg_error_saving_preset_prefix: "Error saving preset: ",
            msg_failed_apply_preset_prefix: "Failed to apply preset: ",
            error_loading_modules_config_prefix:
              "Error loading modules configuration: ",
            msg_server_config_saved: "Configuration saved successfully!",
          },
          zh: {
            // Header & Tabs
            title_main: "MCP-ANY-REST 配置",
            label_language: "语言：",
            tab_presets: "预设配置",
            tab_config_json: "Config.json 设置",
            tab_preview: "配置预览",
            // Presets section
            section_config_presets: "配置预设",
            btn_reload_file: "从文件重新加载",
            btn_save_file: "保存到文件",
            btn_save_as_preset: "保存为预设",
            modal_save_preset_title: "将当前配置保存为预设",
            label_preset_name: "预设名称：",
            placeholder_preset_name: "输入预设名称（例如：custom-config）",
            label_description: "描述：",
            placeholder_preset_description: "输入预设描述",
            label_preset_id: "预设 ID（可选）：",
            placeholder_preset_id: "留空将自动生成 ID",
            preset_preview_title: "配置预览：",
            btn_cancel: "取消",
            btn_save_preset: "保存预设",
            section_preset_management: "预设管理",
            loading_presets: "正在加载预设...",
            // Modules section
            section_module_configuration: "模块配置",
            section_global_module_settings: "全局模块设置",
            label_default_access_level: "默认访问级别：",
            label_default_rate_limit: "默认速率限制（次/分钟）：",
            section_module_details: "模块配置详情",
            placeholder_search_modules: "搜索模块和方法...",
            filter_all_modules: "全部模块",
            filter_enabled_only: "仅启用",
            filter_disabled_only: "仅禁用",
            loading_presets: "正在加载预设...",
            loading_module_config: "正在加载模块配置...",
            // Config JSON
            section_config_json: "Config.json 设置",
            btn_load_config: "加载配置",
            btn_save_config: "保存配置",
            btn_reset_default: "重置为默认",
            label_base_url: "基础 URL：",
            placeholder_base_url: "https://your-zentao-instance.com",
            label_default_username: "默认用户名：",
            placeholder_default_username: "admin",
            label_default_password: "默认密码：",
            placeholder_default_password: "password",
            label_auth_mode: "认证模式：",
            auth_token: "Token",
            auth_bearer: "Bearer",
            auth_basic: "Basic",
            label_server_port: "服务器端口：",
            label_log_level: "日志级别：",
            label_token_refresh_buffer: "令牌刷新缓冲（秒）：",
            label_token_expiry_time: "令牌过期时间（秒）：",
            label_max_retry_attempts: "最大重试次数：",
            // Server/API/Auth sections
            section_server_config: "服务器配置",
            section_api_config: "API 配置",
            section_auth_config: "认证配置",
            subsection_global_auth: "全局认证设置",
            auth_direct_authentication: "直接认证",
            auth_login_authentication: "登录认证",
            // Log level options
            log_error: "错误",
            log_warn: "警告",
            log_info: "信息",
            log_debug: "调试",
            log_trace: "跟踪",
            // Server config labels
            label_max_connections: "最大连接数：",
            // API config labels
            label_timeout: "超时时间（秒）：",
            label_retry_attempts: "重试次数：",
            // Direct auth
            subsection_direct_auth: "直接认证",
            option_bearer_token: "Bearer 令牌",
            option_api_key: "API Key",
            option_basic_auth: "基本认证",
            option_token: "令牌",
            option_custom_headers: "自定义请求头",
            label_api_key_name: "API Key 名称：",
            placeholder_api_key_name: "X-API-Key",
            placeholder_auth_token: "输入认证令牌",
            label_username: "用户名：",
            placeholder_username: "输入用户名",
            label_password: "密码：",
            placeholder_password: "输入密码",
            label_custom_headers: "自定义请求头：",
            placeholder_header_name: "请求头名称",
            placeholder_header_value: "请求头值",
            btn_add_header: "添加请求头",
            // Login auth
            subsection_login_auth: "登录认证",
            label_login_url: "登录 URL：",
            placeholder_login_url: "https://your-server.com/login",
            label_http_method: "HTTP 方法：",
            // HTTP methods
            http_none: "无",
            http_post: "POST",
            http_get: "GET",
            http_put: "PUT",
            http_delete: "DELETE",
            http_patch: "PATCH",
            // Login body type
            label_request_body_type: "请求体类型：",
            body_type_json: "JSON",
            body_type_form: "表单数据",
            body_type_oauth2: "OAuth2",
            body_type_api_key: "API Key",
            body_type_custom: "自定义",
            // Login headers/body
            label_request_headers: "请求头：",
            label_request_body: "请求体：",
            placeholder_param_key: "参数键",
            placeholder_param_value: "参数值",
        btn_add_parameter: "添加参数",
        // Token Extraction
        label_token_extraction: "令牌提取",
        label_source_location: "来源位置",
        response_body: "响应体",
        response_header: "响应头",
        label_token_key: "令牌键",
        placeholder_token_key: "例如 data.token 或 Authorization",
        label_token_format: "令牌格式",
        token_format_bearer: "Bearer",
        token_format_raw: "原始值",
        label_target_location: "目标位置",
        request_header: "请求头",
        request_body: "请求体",
        label_target_key: "目标键",
        placeholder_target_key: "例如 Authorization 或 body.token",
        btn_add_token_extraction: "添加令牌提取",
            // Response format
            label_response_format: "响应格式：",
            response_json: "JSON",
            response_xml: "XML",
            response_text: "文本",
            // Refresh
            label_refresh_url: "刷新 URL（可选）：",
            placeholder_refresh_url: "https://your-server.com/refresh",
            label_refresh_method: "刷新方法（可选）：",
            label_login_token_key: "令牌键名：",
            // Preview
            section_current_preview: "当前配置预览",
            btn_refresh_preview: "刷新预览",
            text_loading: "加载中...",
            // Dynamic common
            no_description: "无描述",
            btn_apply: "应用",
            btn_delete: "删除",
            no_presets: "没有可用的预设。创建一个新预设开始使用。",
            error_loading_presets_prefix: "加载预设出错：",
            error_loading_modules_prefix: "加载模块出错：",
            // Module tree dynamic
            no_modules: "没有可用的模块",
            status_enabled_symbol: "✓ 已启用",
            status_disabled_symbol: "✗ 已禁用",
            methods_suffix: "个方法",
            label_enabled: "启用：",
            label_access_level: "访问级别：",
            label_rate_limit: "速率限制（次/分钟）：",
            access_internal: "内部",
            access_public: "公开",
            access_private: "私有",
            methods_header: "方法",
            status_enabled_label: "已启用",
            status_disabled_label: "已禁用",
            no_methods: "没有可用的方法",
            btn_save: "保存",
            btn_reset: "重置",
            // Preset preview dynamic
            summary_enabled: "启用：",
            enabled_yes: "是",
            enabled_no: "否",
            summary_description: "描述：",
            summary_access_level: "访问级别：",
            summary_rate_limit: "速率限制：",
            req_per_min: "次/分钟",
            // Tip titles
            tip_info: "信息",
            tip_success: "成功",
            tip_warning: "警告",
            tip_error: "错误",
            // Raw JSON
            raw_json_title: "原始 JSON 配置",
            // Contextual tip titles
            tip_title_quick_setup: "快速设置",
            tip_title_module_search: "模块搜索",
            tip_title_direct_editing: "直接编辑",
            tip_title_preview: "配置预览",
            tip_title_real_time_data: "实时数据",
            tip_title_auto_save: "自动保存",
            // Contextual tip messages
            msg_select_preset_quick_apply: "选择一个预设以快速应用常用设置。",
            msg_search_filter_modules: "使用搜索与筛选选项查找特定模块。",
            msg_edit_config_json_direct:
              "直接编辑 config.json 以进行高级更改。",
            msg_preview_structured_config: "此处以结构化方式展示当前配置。",
            msg_click_refresh_preview: "点击“刷新预览”以获取最新配置数据。",
            msg_auto_save_server: "所有更改会自动保存到服务器。",
            // Generic
            unknown_error: "未知错误",
            // Tip titles for operations
            title_preset_applied: "预设已应用",
            title_preset_application_failed: "预设应用失败",
            title_application_error: "应用错误",
            title_configuration_reloaded: "配置已重新加载",
            title_reload_failed: "重新加载失败",
            title_reload_error: "重新加载错误",
            title_configuration_saved: "配置已保存",
            title_save_failed: "保存失败",
            title_save_error: "保存错误",
            title_save_success: "保存成功",
            title_module_updated: "模块已更新",
            title_method_updated: "方法已更新",
            title_update_failed: "更新失败",
            title_update_error: "更新错误",
            title_module_reset: "模块已重置",
            title_reset_failed: "重置失败",
            title_reset_error: "重置错误",
            title_settings_updated: "设置已更新",
            title_validation_error: "校验错误",
            title_load_success: "加载成功",
            title_load_error: "加载错误",
            title_delete_success: "删除成功",
            title_delete_error: "删除错误",
            title_apply_success: "应用成功",
            title_apply_error: "应用错误",
            // Operation messages
            msg_preset_applied: "配置预设已成功应用到系统。",
            msg_failed_apply_selected: "预设应用失败，请重试。",
            msg_config_reset_to_default: "配置已重置为默认！",
            title_reset_success: "重置成功",
            msg_failed_reset_configuration_prefix: "重置配置失败：",
            msg_error_resetting_configuration_prefix: "重置配置出错：",
            msg_failed_save_configuration_prefix: "保存配置失败：",
            msg_error_saving_configuration_prefix: "保存配置出错：",
            msg_error_applying_preset_prefix: "应用预设出错：",
            msg_configuration_reloaded: "已成功从配置文件重新加载配置。",
            msg_failed_reload_config:
              "无法从文件重新加载配置，请检查文件权限。",
            msg_error_reloading_config_prefix: "重新加载配置出错：",
            msg_configuration_saved: "配置已成功保存到配置文件。",
            msg_failed_save_config: "保存配置到文件失败，请检查文件权限。",
            msg_error_saving_config_prefix: "保存配置出错：",
            msg_module_updated_fmt: '模块 "{module}" 已成功更新。',
            msg_failed_update_module_prefix_fmt: '更新模块 "{module}" 失败：',
            msg_error_updating_module_prefix: '更新模块 "{module}" 出错：',
            msg_method_updated_fmt:
              '模块 "{module}" 中的方法 "{method}" 已成功更新。',
            msg_failed_update_method_retry: "更新方法失败，请重试。",
            msg_error_updating_method_prefix:
              '更新方法 "{method}"（模块 "{module}") 出错：',
            msg_module_config_saved_fmt: '模块 "{module}" 配置已成功保存。',
            msg_failed_save_module_config_retry: "保存模块配置失败，请重试。",
            msg_error_saving_module_config_prefix:
              '保存模块 "{module}" 配置出错：',
            msg_module_reset_fmt: '模块 "{module}" 已成功重置为默认设置。',
            msg_failed_reset_module_retry: "重置模块失败，请重试。",
            msg_error_resetting_module_prefix: '重置模块 "{module}" 出错：',
            msg_advanced_updated: "高级设置已成功更新。",
            msg_failed_update_advanced_prefix: "更新高级设置失败：",
            msg_error_update_advanced_prefix: "更新高级设置出错：",
            msg_server_config_loaded: "服务器配置加载成功。",
            msg_failed_load_server_config_prefix: "加载服务器配置失败，状态：",
            msg_error_loading_server_config_prefix: "加载服务器配置出错：",
            validation_rate_limit_min: "速率限制至少为每分钟 1 次",
            validation_rate_limit_max: "速率限制不能超过每分钟 1000 次",
            validation_requests_per_minute_min:
              "每分钟请求数必须为大于 0 的数字",
            validation_requests_per_minute_max: "每分钟请求数不能超过 10000",
            validation_access_level_invalid:
              "访问级别无效，必须为 Internal、Public 或 Private",
            validation_enabled_boolean: "启用字段必须为布尔值",
            validation_preset_required: "预设 ID 和名称为必填",
            validation_preset_id_format:
              "预设 ID 仅允许字母、数字、下划线和连字符",
            msg_preset_saved_success: "预设保存成功！",
            msg_failed_save_configuration_prefix: "保存配置失败：",
            msg_error_saving_configuration_prefix: "保存配置出错：",
            confirm_delete_preset: "确定删除该预设吗？此操作不可撤销。",
            msg_failed_delete_preset_prefix: "删除预设失败：",
            msg_error_deleting_preset_prefix: "删除预设出错：",
            msg_preset_deleted_success: "预设删除成功！",
            msg_failed_save_preset_prefix: "保存预设失败：",
            msg_error_saving_preset_prefix: "保存预设出错：",
            msg_failed_apply_preset_prefix: "应用预设失败：",
            error_loading_modules_config_prefix: "加载模块配置出错：",
            msg_server_config_saved: "配置保存成功！",
          },
        };

        function t(key, fallback) {
          const langPack = i18n[currentLang] || i18n["en"];
          return (langPack && langPack[key]) || fallback || key;
        }

        // Simple template formatter for messages with placeholders like {name}
        function tf(key, params = {}, fallback) {
          let template = t(key, fallback);
          Object.keys(params).forEach((k) => {
            const re = new RegExp("\\{" + k + "\\}", "g");
            template = template.replace(re, params[k]);
          });
          return template;
        }

        function applyTranslations() {
          // Translate text content for elements with data-i18n
          document.querySelectorAll("[data-i18n]").forEach((el) => {
            const key = el.getAttribute("data-i18n");
            const fallback = (el.textContent || "").trim();
            // Preserve child elements if any by only replacing text nodes
            if (el.children && el.children.length > 0) {
              el.childNodes.forEach((node) => {
                if (node.nodeType === Node.TEXT_NODE) {
                  node.textContent = t(key, fallback);
                }
              });
            } else {
              el.textContent = t(key, fallback);
            }
          });
          // Translate placeholders
          document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
            const key = el.getAttribute("data-i18n-placeholder");
            const fallback = el.getAttribute("placeholder") || "";
            el.setAttribute("placeholder", t(key, fallback));
          });
        }

        // Tip System Functions
        function showTip(
          message,
          type = "info",
          title = null,
          duration = 5000
        ) {
          const tipId = currentTipId++;
          const tipContainer = document.getElementById("tip-container");

          // Guard against missing tip container
          if (!tipContainer) {
            console.warn("[Tip] Tip container not found. Skipping tip display.");
            return tipId;
          }

          // Determine icon and title based on type
          const icons = {
            info: "ℹ️",
            success: "✅",
            warning: "⚠️",
            error: "❌",
          };

          const defaultTitles = {
            info: "Information",
            success: "Success",
            warning: "Warning",
            error: "Error",
          };
          const i18nTitleKeys = {
            info: "tip_info",
            success: "tip_success",
            warning: "tip_warning",
            error: "tip_error",
          };

          const tipTitle =
            title || t(i18nTitleKeys[type], defaultTitles[type] || "Tip");
          const tipIcon = icons[type] || "ℹ️";

          // Create tip element
          const tipElement = document.createElement("div");
          tipElement.className = `tip ${type}`;
          tipElement.id = `tip-${tipId}`;
          tipElement.innerHTML = `
                <button class="tip-close" onclick="removeTip(${tipId})">×</button>
                <div class="tip-header">
                    <span class="tip-icon">${tipIcon}</span>
                    <h4 class="tip-title">${tipTitle}</h4>
                </div>
                <p class="tip-content">${message}</p>
            `;

          // Add to container
          tipContainer.appendChild(tipElement);

          // Auto-remove after duration
          if (duration > 0) {
            setTimeout(() => {
              removeTip(tipId);
            }, duration);
          }

          return tipId;
        }

        function removeTip(tipId) {
          const tipElement = document.getElementById(`tip-${tipId}`);
          if (tipElement) {
            tipElement.classList.add("tip-fade-out");
            setTimeout(() => {
              if (tipElement.parentNode) {
                tipElement.parentNode.removeChild(tipElement);
              }
            }, 300);
          }
        }

        function clearAllTips() {
          const tipContainer = document.getElementById("tip-container");
          if (tipContainer) {
            tipContainer.innerHTML = "";
          } else {
            console.warn("[Tip] Tip container not found during clearAllTips.");
          }
          tipQueue = [];
        }

        // Show contextual tips based on current tab and actions
        function showContextualTips() {
          clearAllTips();

          // Get current tab
          const activeTab = document.querySelector(".tab-content.active");
          if (!activeTab) return;

          const tabId = activeTab.id;

          // Show tips based on current tab
          switch (tabId) {
            case "presets":
              showTip(
                t(
                  "msg_select_preset_quick_apply",
                  "Select a preset configuration to quickly apply common settings."
                ),
                "info",
                t("tip_title_quick_setup", "Quick Setup"),
                8000
              );
              showTip(
                t(
                  "msg_search_filter_modules",
                  "Use the search and filter options to find specific modules."
                ),
                "info",
                t("tip_title_module_search", "Module Search"),
                8000
              );
              break;
            case "config-json":
              showTip(
                t(
                  "msg_edit_config_json_direct",
                  "Edit the config.json file directly to make advanced changes."
                ),
                "info",
                t("tip_title_direct_editing", "Direct Editing"),
                8000
              );
              break;
          }

          // Show general tips
          setTimeout(() => {
            showTip(
              t(
                "msg_auto_save_server",
                "All changes are automatically saved to the server."
              ),
              "success",
              t("tip_title_auto_save", "Auto-save"),
              6000
            );
          }, 1000);
        }

        // Tab management
        function showTab(tabName) {
          // Hide all tabs
          document.querySelectorAll(".tab-content").forEach((tab) => {
            tab.classList.remove("active");
          });
          document.querySelectorAll(".tab-button").forEach((btn) => {
            btn.classList.remove("active");
          });

          // Show selected tab
          document.getElementById(tabName).classList.add("active");
          document
            .querySelector(`[onclick="showTab('${tabName}')"]`)
            .classList.add("active");

          // Show contextual tips for the selected tab
          showContextualTips();
        }

        async function applyPreset(preset) {
          try {
            const response = await fetch(`/config/preset/${preset}`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
            });
            if (response.ok) {
              showStatus(t("title_preset_applied", "Preset Applied"), "success");
              showTip(
                t(
                  "msg_preset_applied",
                  "Configuration preset has been successfully applied to your system."
                ),
                "success",
                t("title_preset_applied", "Preset Applied")
              );
              await loadModules();
            } else {
              showStatus(t("title_preset_application_failed", "Preset Application Failed"), "error");
              showTip(
                t(
                  "msg_failed_apply_selected",
                  "Failed to apply the selected preset. Please try again."
                ),
                "error",
                t(
                  "title_preset_application_failed",
                  "Preset Application Failed"
                )
              );
            }
          } catch (error) {
            showStatus(
              t("msg_error_applying_preset_prefix", "Error applying preset: ") +
                error.message,
              "error"
            );
            showTip(
              t("msg_error_applying_preset_prefix", "Error applying preset: ") +
                error.message,
              "error",
              t("title_application_error", "Application Error")
            );
          }
        }

        async function reloadConfig() {
          try {
            const response = await fetch("/config/reload", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
            });
            if (response.ok) {
              showStatus(
                t("title_configuration_reloaded", "Configuration Reloaded"),
                "success"
              );
              showTip(
                t(
                  "msg_configuration_reloaded",
                  "Configuration has been successfully reloaded from the configuration file."
                ),
                "success",
                t("title_configuration_reloaded", "Configuration Reloaded")
              );
              await loadModules();
            } else {
              showStatus(t("title_reload_failed", "Reload Failed"), "error");
              showTip(
                t(
                  "msg_failed_reload_config",
                  "Failed to reload configuration from file. Please check file permissions."
                ),
                "error",
                t("title_reload_failed", "Reload Failed")
              );
            }
          } catch (error) {
            showStatus(
              t("msg_error_reloading_config_prefix", "Error reloading configuration: ") +
                error.message,
              "error"
            );
            showTip(
              t(
                "msg_error_reloading_config_prefix",
                "Error reloading configuration: "
              ) + error.message,
              "error",
              t("title_reload_error", "Reload Error")
            );
          }
        }

        // Build a minimal server payload expected by backend save endpoints
        function buildServerPayload() {
          const cfg = getEnhancedConfig();
          const payload = {
            base_url: cfg.api.base_url,
            server_port: cfg.server.port,
            log_level: cfg.server.log_level,
            auth_mode: cfg.auth.mode,
            token_expiry_time: cfg.auth.token_expiry,
            token_refresh_buffer: cfg.auth.refresh_buffer,
            max_retry_attempts: cfg.auth.max_retry_attempts,
          };
          if (cfg.auth.mode === "login" && cfg.auth.login_config) {
            payload.login_config = cfg.auth.login_config;
          }
          if (cfg.auth.mode === "direct" && cfg.auth.direct_config) {
            payload.direct_config = cfg.auth.direct_config;
          }
          return payload;
        }

        // Collect current module states from the tree UI (name, enabled, methods)
        function collectModulesFromUI() {
          const modules = [];
          document.querySelectorAll(".tree-node").forEach((node) => {
            const name = node.getAttribute("data-module") || "";
            const enabledInput = document.getElementById(`${name}-enabled`);
            const enabled = !!(enabledInput && enabledInput.checked);
            const methods = [];
            node.querySelectorAll(".method-item").forEach((mi) => {
              const mnameEl = mi.querySelector(".method-name");
              const checkbox = mi.querySelector('input[type="checkbox"]');
              const mname = mnameEl ? mnameEl.textContent.trim() : "";
              const menabled = !!(checkbox && checkbox.checked);
              if (mname) {
                methods.push({ name: mname, enabled: menabled });
              }
            });
            if (name) {
              modules.push({ name, enabled, methods });
            }
          });
          return modules;
        }

        async function saveConfig() {
          try {
            // Build precise payloads to avoid unintended module overwrites
            const serverPayload = buildServerPayload();
            const modulesPayload = collectModulesFromUI();

            const response = await fetch("/config/save", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ server: serverPayload, modules: modulesPayload }),
            });

            if (response.ok) {
              showStatus(
                t("title_configuration_saved", "Configuration Saved"),
                "success"
              );
              showTip(
                t(
                  "msg_configuration_saved",
                  "Configuration has been successfully saved to the configuration file."
                ),
                "success",
                t("title_configuration_saved", "Configuration Saved")
              );
            } else {
              const result = await response.json().catch(() => ({ message: "" }));
              showStatus(t("title_save_failed", "Save Failed"), "error");
              showTip(
                t(
                  "msg_failed_save_config",
                  "Failed to save configuration to file. Please check file permissions."
                ) + (result.message ? ` (details: ${result.message})` : ""),
                "error",
                t("title_save_failed", "Save Failed")
              );
            }
          } catch (error) {
            showStatus(
              t("msg_error_saving_configuration_prefix", "Error saving configuration: ") +
                error.message,
              "error"
            );
            showTip(
              t(
                "msg_error_saving_config_prefix",
                "Error saving configuration: "
              ) + error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        async function loadPresets() {
          try {
            const response = await fetch("/config/presets");
            const result = await response.json();

            if (result.success) {
              presetsData = result.presets;

              // Update preset list display
              const presetList = document.getElementById("preset-list");
              if (presetsData.length > 0) {
                presetList.innerHTML = presetsData
                  .map(
                    (preset) => `
                                <div class="preset-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #ddd; margin-bottom: 5px; border-radius: 4px;">
                                    <div>
                                        <strong>${preset.name}</strong> (${
                      preset.id
                    })
                                        <br><small style="color: #666;">${
                                          preset.description ||
                                          t("no_description", "No description")
                                        }</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-primary btn-sm" onclick="applyPreset('${
                                          preset.id
                                        }')" style="margin-right: 5px;">${t(
                      "btn_apply",
                      "Apply"
                    )}</button>
                                        <button class="btn btn-danger btn-sm" onclick="deletePreset('${
                                          preset.id
                                        }')">${t(
                      "btn_delete",
                      "Delete"
                    )}</button>
                                    </div>
                                </div>
                            `
                  )
                  .join("");
              } else {
                presetList.innerHTML = `<p>${t(
                  "no_presets",
                  "No presets available. Create a new preset to get started."
                )}</p>`;
              }
            } else {
              const presetList = document.getElementById("preset-list");
              presetList.innerHTML = `<p>${t(
                "error_loading_presets_prefix",
                "Error loading presets: "
              )}${result.message}</p>`;
            }
          } catch (error) {
            const presetList = document.getElementById("preset-list");
            presetList.innerHTML = `<p>${t(
              "error_loading_presets_prefix",
              "Error loading presets: "
            )}${error.message}</p>`;
          }
        }

        let syntaxHighlightEnabled = true;

        async function loadModules() {
          try {
            const response = await fetch("/config/modules");
            modulesData = await response.json();
            renderModuleTree();
          } catch (error) {
            document.getElementById("module-tree").innerHTML =
              `<p>${t(
                "error_loading_modules_prefix",
                "Error loading modules: "
              )}${error.message}</p>`;
          }
        }

        function renderModuleTree() {
          const container = document.getElementById("module-tree");
          if (!modulesData.length) {
            container.innerHTML = `<p>${t(
              "no_modules",
              "No modules available"
            )}</p>`;
            return;
          }

          container.innerHTML = modulesData
            .map(
              (module) => `
                <div class="tree-node" data-module="${
                  module.name
                }" data-enabled="${module.enabled}">
                    <div class="tree-header collapsed" onclick="toggleTreeNode('${
                      module.name
                    }')">
                        <span class="tree-toggle"></span>
                        <span class="tree-title">${module.name}</span>
                        <span class="tree-status ${
                          module.enabled ? "enabled" : "disabled"
                        }">
                            ${
                              module.enabled
                                ? t("status_enabled_symbol", "✓ Enabled")
                                : t("status_disabled_symbol", "✗ Disabled")
                            }
                        </span>
                        <span class="method-count">${
                          module.methods ? module.methods.length : 0
                        } ${t("methods_suffix", "methods")}</span>
                    </div>
                    <div class="tree-content" id="tree-content-${module.name}">
                        <div class="config-form">
                            <div class="form-group">
                                <label for="${module.name}-enabled">${t(
                "label_enabled",
                "Enabled:"
              )}</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="${
                                      module.name
                                    }-enabled" ${
                module.enabled ? "checked" : ""
              } onchange="updateModule('${
                module.name
              }', 'enabled', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="${module.name}-accessLevel">${t(
                "label_access_level",
                "Access Level:"
              )}</label>
                                <select id="${
                                  module.name
                                }-accessLevel" onchange="updateModule('${
                module.name
              }', 'accessLevel', this.value)">
                                    <option value="Internal" ${
                                      module.accessLevel === "Internal"
                                        ? "selected"
                                        : ""
                                    }>${t(
                "access_internal",
                "Internal"
              )}</option>
                                    <option value="Public" ${
                                      module.accessLevel === "Public"
                                        ? "selected"
                                        : ""
                                    }>${t("access_public", "Public")}</option>
                                    <option value="Private" ${
                                      module.accessLevel === "Private"
                                        ? "selected"
                                        : ""
                                    }>${t("access_private", "Private")}</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="${module.name}-rateLimit">${t(
                "label_rate_limit",
                "Rate Limit (req/min):"
              )}</label>
                                <input type="number" id="${
                                  module.name
                                }-rateLimit" value="${
                module.rateLimit || 60
              }" min="1" onchange="updateModule('${
                module.name
              }', 'rateLimit', parseInt(this.value))">
                            </div>
                        </div>
                        
                        <div class="tree-methods">
                            <h5>${t("methods_header", "Methods")} (${
                module.methods ? module.methods.length : 0
              }):</h5>
                            ${
                              module.methods
                                ? module.methods
                                    .map(
                                      (method) => `
                                <div class="method-item">
                                    <span class="method-name">${
                                      method.name
                                    }</span>
                                    <div class="method-controls">
                                        <label class="switch">
                                            <input type="checkbox" ${
                                              method.enabled ? "checked" : ""
                                            } onchange="updateMethod('${
                                        module.name
                                      }', '${
                                        method.name
                                      }', 'enabled', this.checked)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="method-status ${
                                          method.enabled
                                            ? "enabled"
                                            : "disabled"
                                        }">
                                            ${
                                              method.enabled
                                                ? t(
                                                    "status_enabled_label",
                                                    "Enabled"
                                                  )
                                                : t(
                                                    "status_disabled_label",
                                                    "Disabled"
                                                  )
                                            }
                                        </span>
                                    </div>
                                </div>
                            `
                                    )
                                    .join("")
                                : `<p>${t(
                                    "no_methods",
                                    "No methods available"
                                  )}</p>`
                            }
                        </div>
                        
                        <div class="tree-controls">
                            <button class="btn btn-success" onclick="saveModuleConfig('${
                              module.name
                            }')">${t("btn_save", "Save")}</button>
                            <button class="btn btn-primary" onclick="resetModule('${
                              module.name
                            }')">${t("btn_reset", "Reset")}</button>
                        </div>
                    </div>
                </div>
            `
            )
            .join("");
        }

        function toggleTreeNode(moduleName) {
          const header = document.querySelector(
            `[data-module="${moduleName}"] .tree-header`
          );
          const content = document.getElementById(`tree-content-${moduleName}`);
          const toggle = header.querySelector(".tree-toggle");

          if (content.classList.contains("expanded")) {
            // Collapse
            content.classList.remove("expanded");
            header.classList.remove("expanded");
            header.classList.add("collapsed");
            toggle.classList.remove("expanded");
          } else {
            // Expand
            content.classList.add("expanded");
            header.classList.add("expanded");
            header.classList.remove("collapsed");
            toggle.classList.add("expanded");
          }
        }

        function setTreeFilter(filter) {
          // Update filter buttons
          document
            .querySelectorAll(".filter-btn")
            .forEach((btn) => btn.classList.remove("active"));
          event.target.classList.add("active");

          // Apply filter
          const modules = document.querySelectorAll(".tree-node");
          modules.forEach((module) => {
            const isEnabled = module.getAttribute("data-enabled") === "true";

            switch (filter) {
              case "all":
                module.style.display = "block";
                break;
              case "enabled":
                module.style.display = isEnabled ? "block" : "none";
                break;
              case "disabled":
                module.style.display = isEnabled ? "none" : "block";
                break;
            }
          });
        }

        function filterTree() {
          const searchTerm = document
            .getElementById("module-search")
            .value.toLowerCase();
          const modules = document.querySelectorAll(".tree-node");

          modules.forEach((module) => {
            const moduleName = module.getAttribute("data-module").toLowerCase();
            const methodItems = module.querySelectorAll(".method-item");
            let hasMatch = moduleName.includes(searchTerm);

            // Check methods for matches
            methodItems.forEach((method) => {
              const methodName = method
                .querySelector(".method-name")
                .textContent.toLowerCase();
              if (methodName.includes(searchTerm)) {
                hasMatch = true;
                method.style.display = "flex";
              } else {
                method.style.display = searchTerm ? "none" : "flex";
              }
            });

            module.style.display = hasMatch ? "block" : "none";
          });
        }

        async function updateModule(moduleName, field, value) {
          // 实时验证
          const validationError = validateModuleField(moduleName, field, value);
          if (validationError) {
            showStatus(validationError, "error");
            showTip(validationError, "error", "Validation Error");
            return;
          }

          // 保存当前展开状态
          const expandedModules = [];
          document.querySelectorAll(".tree-node").forEach((node) => {
            const moduleName = node.getAttribute("data-module");
            const content = document.getElementById(
              `tree-content-${moduleName}`
            );
            if (content && content.classList.contains("expanded")) {
              expandedModules.push(moduleName);
            }
          });

          try {
            const response = await fetch(`/config/modules/${moduleName}`, {
              method: "PATCH",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ [field]: value }),
            });

            const result = await response.json();

            if (response.ok) {
              showStatus(t("title_module_updated", "Module Updated"), "success");
              showTip(
                tf(
                  "msg_module_updated_fmt",
                  { module: moduleName },
                  `Module "${moduleName}" has been successfully updated.`
                ),
                "success",
                t("title_module_updated", "Module Updated")
              );
              await loadModules();

              // 恢复之前展开的状态
              expandedModules.forEach((expandedModule) => {
                const content = document.getElementById(
                  `tree-content-${expandedModule}`
                );
                const header = document.querySelector(
                  `[data-module="${expandedModule}"] .tree-header`
                );
                const toggle = header
                  ? header.querySelector(".tree-toggle")
                  : null;

                if (content && header && toggle) {
                  content.classList.add("expanded");
                  header.classList.add("expanded");
                  header.classList.remove("collapsed");
                  toggle.classList.add("expanded");
                }
              });
            } else {
              showStatus(t("title_update_failed", "Update Failed"), "error");
              showTip(
                tf(
                  "msg_failed_update_module_prefix_fmt",
                  { module: moduleName },
                  `Failed to update module "${moduleName}": `
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_update_failed", "Update Failed")
              );
            }
          } catch (error) {
            showStatus(
              tf(
                "msg_error_updating_module_prefix",
                { module: moduleName },
                `Error updating module "${moduleName}": `
              ) + error.message,
              "error"
            );
            showTip(
              tf(
                "msg_error_updating_module_prefix",
                { module: moduleName },
                `Error updating module "${moduleName}": `
              ) + error.message,
              "error",
              t("title_update_error", "Update Error")
            );
          }
        }

        function validateModuleField(moduleName, field, value) {
          switch (field) {
            case "rateLimit":
              if (value < 1) {
                return t(
                  "validation_rate_limit_min",
                  "Rate limit must be at least 1 request per minute"
                );
              }
              if (value > 1000) {
                return t(
                  "validation_rate_limit_max",
                  "Rate limit cannot exceed 1000 requests per minute"
                );
              }
              break;
            case "accessLevel":
              if (!["Internal", "Public", "Private"].includes(value)) {
                return t(
                  "validation_access_level_invalid",
                  "Invalid access level. Must be Internal, Public, or Private"
                );
              }
              break;
            case "enabled":
              if (typeof value !== "boolean") {
                return t(
                  "validation_enabled_boolean",
                  "Enabled field must be a boolean value"
                );
              }
              break;
          }
          return null;
        }

        async function updateMethod(moduleName, methodName, field, value) {
          try {
            const response = await fetch(
              `/config/modules/${moduleName}/methods/${methodName}`,
              {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ [field]: value }),
              }
            );
            if (response.ok) {
              showStatus(t("title_method_updated", "Method Updated"), "success");
              showTip(
                tf(
                  "msg_method_updated_fmt",
                  { method: methodName, module: moduleName },
                  `Method "${methodName}" in module "${moduleName}" has been successfully updated.`
                ),
                "success",
                t("title_method_updated", "Method Updated")
              );

              // 实时更新界面状态文本
              const methodItems = document.querySelectorAll(".method-item");
              for (const methodItem of methodItems) {
                const nameSpan = methodItem.querySelector(".method-name");
                if (nameSpan && nameSpan.textContent === methodName) {
                  const statusSpan = methodItem.querySelector(".method-status");
                  if (statusSpan) {
                    statusSpan.textContent = value
                      ? t("status_enabled_label", "Enabled")
                      : t("status_disabled_label", "Disabled");
                    statusSpan.className = `method-status ${
                      value ? "enabled" : "disabled"
                    }`;
                  }
                  break;
                }
              }
            } else {
              showStatus(t("title_update_failed", "Update Failed"), "error");
              showTip(
                tf(
                  "msg_failed_update_method_retry",
                  { method: methodName, module: moduleName },
                  `Failed to update method "${methodName}" in module "${moduleName}". Please try again.`
                ),
                "error",
                t("title_update_failed", "Update Failed")
              );
            }
          } catch (error) {
            showStatus(t("title_update_error", "Update Error"), "error");
            showTip(
              tf(
                "msg_error_updating_method_prefix",
                { method: methodName, module: moduleName },
                `Error updating method "${methodName}" in module "${moduleName}": `
              ) + error.message,
              "error",
              t("title_update_error", "Update Error")
            );
          }
        }

        async function saveModuleConfig(moduleName) {
          try {
            const moduleConfig = {
              enabled: document.getElementById(`${moduleName}-enabled`).checked,
              accessLevel: document.getElementById(`${moduleName}-accessLevel`)
                .value,
              rateLimit: parseInt(
                document.getElementById(`${moduleName}-rateLimit`).value
              ),
            };

            const response = await fetch(`/config/modules/${moduleName}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(moduleConfig),
            });
            if (response.ok) {
              showStatus(
                `Module ${moduleName} configuration saved!`,
                "success"
              );
              showTip(
                tf(
                  "msg_module_config_saved_fmt",
                  { module: moduleName },
                  `Module "${moduleName}" configuration has been successfully saved.`
                ),
                "success",
                t("title_configuration_saved", "Configuration Saved")
              );
            } else {
              showStatus(
                tf(
                  "msg_failed_save_module_config_retry",
                  { module: moduleName },
                  `Failed to save module "${moduleName}" configuration. Please try again.`
                ),
                "error"
              );
              showTip(
                tf(
                  "msg_failed_save_module_config_retry",
                  { module: moduleName },
                  `Failed to save module "${moduleName}" configuration. Please try again.`
                ),
                "error",
                t("title_save_failed", "Save Failed")
              );
            }
          } catch (error) {
            showStatus(
              tf(
                "msg_error_saving_module_config_prefix",
                { module: moduleName },
                `Error saving module "${moduleName}" configuration: `
              ) + error.message,
              "error"
            );
            showTip(
              tf(
                "msg_error_saving_module_config_prefix",
                { module: moduleName },
                `Error saving module "${moduleName}" configuration: `
              ) + error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        async function resetModule(moduleName) {
          try {
            // 保存当前展开状态
            const expandedModules = [];
            const treeNodes = document.querySelectorAll(".tree-node");
            for (const node of treeNodes) {
              if (node.classList.contains("expanded")) {
                const moduleNameSpan = node.querySelector(".module-name");
                if (moduleNameSpan) {
                  expandedModules.push(moduleNameSpan.textContent);
                }
              }
            }

            const response = await fetch(
              `/config/modules/${moduleName}/reset`,
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
              }
            );
            if (response.ok) {
              showStatus(t("title_module_reset", "Module Reset"), "success");
              showTip(
                tf(
                  "msg_module_reset_fmt",
                  { module: moduleName },
                  `Module "${moduleName}" has been successfully reset to default settings.`
                ),
                "success",
                t("title_module_reset", "Module Reset")
              );
              await loadModules();

              // 恢复之前展开的状态
              if (expandedModules.length > 0) {
                const newTreeNodes = document.querySelectorAll(".tree-node");
                for (const node of newTreeNodes) {
                  const moduleNameSpan = node.querySelector(".module-name");
                  if (
                    moduleNameSpan &&
                    expandedModules.includes(moduleNameSpan.textContent)
                  ) {
                    node.classList.add("expanded");
                    const content = node.querySelector(".tree-content");
                    if (content) {
                      content.style.display = "block";
                    }
                    const header = node.querySelector(".tree-header");
                    if (header) {
                      const toggleIcon = header.querySelector(".toggle-icon");
                      if (toggleIcon) {
                        toggleIcon.textContent = "▼";
                      }
                    }
                  }
                }
              }
            } else {
              showStatus(t("title_reset_failed", "Reset Failed"), "error");
              showTip(
                tf(
                  "msg_failed_reset_module_retry",
                  { module: moduleName },
                  `Failed to reset module "${moduleName}". Please try again.`
                ),
                "error",
                t("title_reset_failed", "Reset Failed")
              );
            }
          } catch (error) {
            showStatus(
              tf(
                "msg_error_resetting_module_prefix",
                { module: moduleName },
                `Error resetting module "${moduleName}": `
              ) + error.message,
              "error"
            );
            showTip(
              tf(
                "msg_error_resetting_module_prefix",
                { module: moduleName },
                `Error resetting module "${moduleName}": `
              ) + error.message,
              "error",
              t("title_reset_error", "Reset Error")
            );
          }
        }

        async function updateAdvancedConfig() {
          // 验证高级配置
          const validationError = validateAdvancedConfig();
          if (validationError) {
            showStatus(validationError, "error");
            showTip(
              validationError,
              "error",
              t("title_validation_error", "Validation Error")
            );
            return;
          }

          try {
            const advancedConfig = {
              defaultAccessLevel:
                document.getElementById("defaultAccessLevel").value,
              rateLimitEnabled:
                document.getElementById("rateLimitEnabled").checked,
              requestsPerMinute: parseInt(
                document.getElementById("requestsPerMinute").value
              ),
            };

            const response = await fetch("/config/advanced", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(advancedConfig),
            });

            const result = await response.json();

            if (response.ok) {
              showStatus(t("title_settings_updated", "Settings Updated"), "success");
              showTip(
                t(
                  "msg_advanced_updated",
                  "Advanced settings have been successfully updated."
                ),
                "success",
                t("title_settings_updated", "Settings Updated")
              );
              // 更新当前配置显示
              await loadConfig();
            } else {
              showStatus(
                t(
                  "msg_failed_update_advanced_prefix",
                  "Failed to update advanced settings: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error"
              );
              showTip(
                t(
                  "msg_failed_update_advanced_prefix",
                  "Failed to update advanced settings: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_update_failed", "Update Failed")
              );
            }
          } catch (error) {
            showStatus(
              t(
                "msg_error_update_advanced_prefix",
                "Error updating advanced settings: "
              ) + error.message,
              "error"
            );
            showTip(
              t(
                "msg_error_update_advanced_prefix",
                "Error updating advanced settings: "
              ) + error.message,
              "error",
              t("title_update_error", "Update Error")
            );
          }
        }

        function validateAdvancedConfig() {
          const requestsPerMinute = parseInt(
            document.getElementById("requestsPerMinute").value
          );

          if (isNaN(requestsPerMinute) || requestsPerMinute < 1) {
            return t(
              "validation_requests_per_minute_min",
              "Requests per minute must be a number greater than 0"
            );
          }

          if (requestsPerMinute > 10000) {
            return t(
              "validation_requests_per_minute_max",
              "Requests per minute cannot exceed 10000"
            );
          }

          const defaultAccessLevel =
            document.getElementById("defaultAccessLevel").value;
          if (!["Internal", "Public", "Private"].includes(defaultAccessLevel)) {
            return t(
              "validation_access_level_invalid",
              "Invalid default access level"
            );
          }

          return null;
        }

        // 实时验证输入
        function setupRealTimeValidation() {
          const requestsInput = document.getElementById("requestsPerMinute");
          if (requestsInput) {
            requestsInput.addEventListener("input", function () {
              const value = parseInt(this.value);
              if (isNaN(value) || value < 1) {
                this.style.borderColor = "#F44336";
              } else {
                this.style.borderColor = "#4CAF50";
              }
            });
          }
        }

        function showStatus(message, type) {
          const statusDiv = document.getElementById("status");
          statusDiv.textContent = message;
          statusDiv.className = `status ${type}`;
          setTimeout(() => {
            statusDiv.textContent = "";
            statusDiv.className = "status";
          }, 5000);
        }

        // Enhanced Configuration Editor Functions
        function initializeEnhancedConfigEditor() {
          // Initialize section toggles
          const sections = document.querySelectorAll(".config-section");
          sections.forEach((section) => {
            const header = section.querySelector(".section-header");
            if (header) {
              header.addEventListener("click", () => {
                toggleSection(section.id);
              });
            }
          });

          // Initialize authentication mode toggle
          const authModeSelect = document.getElementById("auth_mode");
          if (authModeSelect) {
            authModeSelect.addEventListener("change", toggleAuthConfig);
          }

          // Initialize direct auth type toggle
          const directAuthTypeSelect = document.getElementById("direct_auth_type");
          if (directAuthTypeSelect) {
            directAuthTypeSelect.addEventListener("change", toggleDirectAuthConfig);
            // Set initial state
            toggleDirectAuthConfig();
          }

          // Load initial configuration
          loadEnhancedConfig();
        }

        function toggleSection(sectionId) {
          const section = document.getElementById(sectionId);
          if (section) {
            section.classList.toggle("collapsed");
          }
        }

        function toggleAuthConfig() {
          const authMode = document.getElementById("auth_mode").value;
          const directAuthConfig =
            document.getElementById("direct-auth-config");
          const loginAuthConfig = document.getElementById("login-auth-config");

          if (authMode === "direct") {
            directAuthConfig.style.display = "block";
            loginAuthConfig.style.display = "none";
            toggleDirectAuthConfig(); // Update direct auth config visibility
          } else if (authMode === "login") {
            directAuthConfig.style.display = "none";
            loginAuthConfig.style.display = "block";
          }
        }

        function toggleDirectAuthConfig() {
          const authType = document.getElementById("direct_auth_type").value;
          
          // Get all field groups
          const tokenField = document.getElementById("auth_token").closest(".form-group");
          const apiKeyNameField = document.getElementById("api_key_name").closest(".form-group");
          const usernameField = document.getElementById("username").closest(".form-group");
          const passwordField = document.getElementById("password").closest(".form-group");
          const customHeadersConfig = document.getElementById("custom-headers-config");
          
          // Hide all fields first
          tokenField.style.display = "none";
          apiKeyNameField.style.display = "none";
          usernameField.style.display = "none";
          passwordField.style.display = "none";
          customHeadersConfig.style.display = "none";
          
          // Show fields based on auth type
          switch (authType) {
            case "bearer":
              tokenField.style.display = "block";
              break;
            case "api_key":
              tokenField.style.display = "block";
              apiKeyNameField.style.display = "block";
              break;
            case "basic":
              usernameField.style.display = "block";
              passwordField.style.display = "block";
              break;
            case "token":
              tokenField.style.display = "block";
              break;
            case "custom_headers":
              customHeadersConfig.style.display = "block";
              break;
          }
        }

        async function loadEnhancedConfig() {
          try {
            const response = await fetch("/config/server");
            if (response.ok) {
              const result = await response.json();
              const cfg = result.config || result;
              // Normalize server response to enhanced editor expected shape
              const normalized = {
                server: {
                  port: cfg.server_port ?? 8081,
                  log_level: cfg.log_level ?? "info",
                },
                api: {
                  base_url: cfg.base_url ?? "",
                },
                auth: {
                  mode: cfg.auth_mode ?? "direct",
                  token_expiry: cfg.token_expiry_time ?? 3600,
                  refresh_buffer: cfg.token_refresh_buffer ?? 300,
                  max_retry_attempts: cfg.max_retry_attempts ?? 3,
                  direct_config: cfg.direct_config ?? null,
                  login_config: cfg.login_config ?? null,
                },
                module_config: cfg.module_config ?? {},
              };
              displayEnhancedConfig(normalized);
            }
          } catch (error) {
            console.error("Error loading enhanced config:", error);
          }
        }

        function displayEnhancedConfig(configData) {
          // Server Configuration
          if (configData.server) {
            document.getElementById("server_port").value =
              configData.server.port || 3000;
            document.getElementById("log_level").value =
              configData.server.log_level || "info";
            document.getElementById("max_connections").value =
              configData.server.max_connections || 100;
          }

          // API Configuration
          if (configData.api) {
            document.getElementById("base_url").value =
              configData.api.base_url || "";
            document.getElementById("timeout").value =
              configData.api.timeout || 30;
            document.getElementById("retry_attempts").value =
              configData.api.retry_attempts || 3;
            document.getElementById("rate_limit").value =
              configData.api.rate_limit || 60;
          }

          // Authentication Configuration
          if (configData.auth) {
            document.getElementById("auth_mode").value =
              configData.auth.mode || "direct";
            document.getElementById("token_expiry").value =
              configData.auth.token_expiry || 3600;
            document.getElementById("refresh_buffer").value =
              configData.auth.refresh_buffer || 300;
            document.getElementById("max_retry_attempts").value =
              configData.auth.max_retry_attempts || 3;

            if (configData.auth.direct_config) {
              document.getElementById("direct_auth_type").value =
                configData.auth.direct_config.auth_type || "bearer";
              document.getElementById("auth_token").value =
                configData.auth.direct_config.token || "";
              document.getElementById("api_key_name").value =
                configData.auth.direct_config.api_key_name || "";
              document.getElementById("username").value =
                configData.auth.direct_config.username || "";
              document.getElementById("password").value =
                configData.auth.direct_config.password || "";
              
              // Set custom headers for direct authentication
              if (configData.auth.direct_config.custom_headers) {
                setHeadersToContainer("custom-headers-container", configData.auth.direct_config.custom_headers);
              }
            }

            if (configData.auth.login_config) {
              document.getElementById("login_auth_type").value =
                configData.auth.login_config.auth_type || "json";
              document.getElementById("login_url").value =
                configData.auth.login_config.url || "";
              document.getElementById("login_method").value =
                configData.auth.login_config.method || "POST";
              document.getElementById("response_format").value =
                configData.auth.login_config.response_format || "json";
              document.getElementById("refresh_url").value =
                configData.auth.login_config.refresh_url || "";
              document.getElementById("refresh_method").value =
                configData.auth.login_config.refresh_method || "";
              
              // Set headers for login authentication
              if (configData.auth.login_config.headers) {
                setHeadersToContainer("login-headers-container", configData.auth.login_config.headers);
              }
              
              // Set body for login authentication
              if (configData.auth.login_config.body) {
                setBodyToContainer("login-body-container", configData.auth.login_config.body);
              }

              // Set token extraction for login authentication
              const te = configData.auth.login_config.token_extraction;
              if (te) {
                const tokens = Array.isArray(te) ? te : (te.tokens || []);
                setTokenExtractionToContainer(tokens);
              } else {
                setTokenExtractionToContainer([]);
              }
            }
          }

          // Module Configuration
          if (configData.module_config) {
            document.getElementById("default_access_level").value =
              configData.module_config.default_access_level || "internal";
            const drl = configData.module_config.default_rate_limit;
            document.getElementById("default_rate_limit").value =
              (drl && typeof drl === "object" && "requests_per_minute" in drl)
                ? drl.requests_per_minute
                : (typeof drl === "number" ? drl : 60);
            // Removed unused UI controls: modules_enabled, auto_discover_modules, module_cache_ttl
          }

          // Update UI based on loaded config
          toggleAuthConfig();
        }

        function getEnhancedConfig() {
          const authMode = document.getElementById("auth_mode").value || "direct";

          const directConfig = {
            auth_type: document.getElementById("direct_auth_type").value || "bearer",
            token: document.getElementById("auth_token").value || "",
            api_key_name: document.getElementById("api_key_name").value || "",
            username: document.getElementById("username").value || "",
            password: document.getElementById("password").value || "",
            custom_headers: getHeadersFromContainer("custom-headers-container"),
          };

          const loginConfig = {
            auth_type: document.getElementById("login_auth_type").value || "json",
            url: document.getElementById("login_url").value || "",
            method: document.getElementById("login_method").value || "POST",
            headers: getHeadersFromContainer("login-headers-container"),
            body: getBodyFromContainer("login-body-container"),
            response_format: document.getElementById("response_format").value || "json",
            token_extraction: { tokens: getTokenExtractionFromContainer() },
            refresh_url: document.getElementById("refresh_url").value || "",
            refresh_method: document.getElementById("refresh_method").value || "",
          };

          return {
            server: {
              port: parseInt(document.getElementById("server_port").value) || 3000,
              log_level: document.getElementById("log_level").value || "info",
            },
            api: {
              base_url: document.getElementById("base_url").value || "",
              timeout: parseInt(document.getElementById("timeout").value) || 30,
            },
            auth: {
              mode: authMode,
              token_expiry: parseInt(document.getElementById("token_expiry").value) || 3600,
              refresh_buffer: parseInt(document.getElementById("refresh_buffer").value) || 300,
              max_retry_attempts: parseInt(document.getElementById("max_retry_attempts").value) || 3,
              direct_config: authMode === "direct" ? directConfig : null,
              login_config: authMode === "login" ? loginConfig : null,
            },
            module_config: {
              default_access_level: document.getElementById("default_access_level").value || "internal",
              default_rate_limit: null,
              modules: {},
            },
          };
        }

        async function saveEnhancedConfig() {
          try {
            const configData = getEnhancedConfig();

            const response = await fetch("/config/server", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(configData),
            });

            if (response.ok) {
              showStatus(t("title_save_success", "Save Success"), "success");
              showTip(
                t(
                  "msg_configuration_saved",
                  "Configuration has been successfully saved to the configuration file."
                ),
                "success",
                t("title_save_success", "Save Success")
              );
            } else {
              const result = await response.json();
              showStatus(
                t(
                  "msg_failed_save_configuration_prefix",
                  "Failed to save configuration: "
                ) + result.message,
                "error"
              );
              showTip(
                t(
                  "msg_failed_save_config",
                  "Failed to save configuration to file. Please check file permissions."
                ) + (result.message ? ` (details: ${result.message})` : ""),
                "error",
                t("title_save_error", "Save Error")
              );
            }
          } catch (error) {
            showStatus(
              t(
                "msg_error_saving_configuration_prefix",
                "Error saving configuration: "
              ) + error.message,
              "error"
            );
            showTip(
              t("msg_error_saving_config_prefix", "Error saving configuration: ") +
                error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        // Load config and changes on page load
        document.addEventListener("DOMContentLoaded", async () => {
          // Initialize segmented toggle for language
          const toggleButtons = document.querySelectorAll(
            ".segmented-toggle .toggle-option"
          );
          if (toggleButtons.length) {
            toggleButtons.forEach((btn) => {
              const isActive = btn.dataset.lang === currentLang;
              btn.classList.toggle("active", isActive);
              btn.setAttribute("aria-selected", isActive ? "true" : "false");
              btn.addEventListener("click", () => {
                currentLang = btn.dataset.lang;
                localStorage.setItem("language", currentLang);
                toggleButtons.forEach((b) => {
                  const active = b === btn;
                  b.classList.toggle("active", active);
                  b.setAttribute("aria-selected", active ? "true" : "false");
                });
                applyTranslations();
                // Re-render dynamic content to reflect translations
                renderModuleTree();
                updatePresetPreview();
                loadPresets();
              });
            });
          } else {
            // Fallback for legacy <select> if present
            const langSelect = document.getElementById("language-select");
            if (langSelect) {
              langSelect.value = currentLang;
              langSelect.addEventListener("change", function () {
                currentLang = this.value;
                localStorage.setItem("language", currentLang);
                applyTranslations();
                renderModuleTree();
                updatePresetPreview();
                loadPresets();
              });
            }
          }
          applyTranslations();

          await loadModules();
          await loadPresets();
          await loadServerConfig();
          setupRealTimeValidation();

          // Initialize enhanced configuration editor
          initializeEnhancedConfigEditor();
        });

        // Load config.json configuration
        async function loadServerConfig() {
          try {
            const response = await fetch("/config/server");
            if (response.ok) {
              const configData = await response.json();
              displayServerConfig(configData);
              showTip(
                t(
                  "msg_server_config_loaded",
                  "Server configuration loaded successfully."
                ),
                "success",
                t("title_load_success", "Load Success")
              );
            } else {
              showTip(
                t(
                  "msg_failed_load_server_config_prefix",
                  "Failed to load server configuration. Status: "
                ) + response.statusText,
                "error",
                t("title_load_error", "Load Error")
              );
            }
          } catch (error) {
            console.error("Error loading config:", error);
            showTip(
              t(
                "msg_error_loading_server_config_prefix",
                "Error loading server configuration: "
              ) + error.message,
              "error",
              t("title_load_error", "Load Error")
            );
          }
        }

        function displayServerConfig(configData) {
          console.log("Server Config:", configData);
          configData = configData.config;
          document.getElementById("base_url").value = configData.base_url;
          document.getElementById("auth_mode").value = configData.auth_mode;
          document.getElementById("server_port").value = configData.server_port;
          document.getElementById("log_level").value = configData.log_level;
          document.getElementById("token_refresh_buffer").value =
            configData.token_refresh_buffer;
          document.getElementById("token_expiry_time").value =
            configData.token_expiry_time;
          document.getElementById("max_retry_attempts").value =
            configData.max_retry_attempts;

          // Handle authentication configuration
          toggleAuthConfig();

          // If login auth mode, populate login configuration
          if (configData.auth_mode === "login" && configData.login_config) {
            // Basic fields
            document.getElementById("login_url").value =
              configData.login_config.url || "";
            document.getElementById("login_method").value =
              configData.login_config.method || "POST";
            document.getElementById("login_auth_type").value =
              configData.login_config.auth_type || "json";
            document.getElementById("response_format").value =
              configData.login_config.response_format || "json";
            document.getElementById("refresh_url").value =
              configData.login_config.refresh_url || "";
            document.getElementById("refresh_method").value =
              configData.login_config.refresh_method || "";

            // Headers and body containers
            if (configData.login_config.headers) {
              setHeadersToContainer("login-headers-container", configData.login_config.headers);
            }
            if (configData.login_config.body) {
              setBodyToContainer("login-body-container", configData.login_config.body);
            }

            // Token extraction configuration
            if (configData.login_config.token_extraction) {
              setTokenExtractionToContainer(configData.login_config.token_extraction);
            }
          }

          // If direct auth mode, populate direct configuration
          if (configData.auth_mode === "direct" && configData.direct_config) {
            document.getElementById("direct_auth_type").value =
              configData.direct_config.auth_type || "token";
            // Direct auth specific fields
            document.getElementById("auth_token").value =
              configData.direct_config.token || "";
            document.getElementById("api_key_name").value =
              configData.direct_config.api_key_name || "";
            document.getElementById("username").value =
              configData.direct_config.username || "";
            document.getElementById("password").value =
              configData.direct_config.password || "";
            if (configData.direct_config.custom_headers) {
              setHeadersToContainer("custom-headers-container", configData.direct_config.custom_headers);
            }
            // Ensure correct field visibility
            toggleDirectAuthConfig();
          }
        }

        async function saveServerConfig() {
          try {
            // Build minimal server-only payload
            const payload = buildServerPayload();

            const response = await fetch("/config/server", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (response.ok) {
              showTip(
                t(
                  "msg_server_config_saved",
                  "Configuration saved successfully!"
                ),
                "success",
                t("title_save_success", "Save Success")
              );
            } else {
              const result = await response.json();
              showTip(
                t(
                  "msg_failed_save_configuration_prefix",
                  "Failed to save configuration: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_save_error", "Save Error")
              );
            }
          } catch (error) {
            showTip(
              t(
                "msg_error_saving_configuration_prefix",
                "Error saving configuration: "
              ) + error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        // Save preset functions
        async function openSavePresetModal() {
          const modal = document.getElementById("savePresetModal");
          modal.style.display = "block";

          // 生成默认ID和名称
          const presetId = "custom_" + Date.now();
          const presetName = "Custom Preset " + new Date().toLocaleDateString();

          document.getElementById("preset-id-input").value = presetId;
          document.getElementById("preset-name-input").value = presetName;
          document.getElementById("preset-description-input").value = "";

          // 预览当前配置
          await updatePresetPreview();
        }

        function closeSavePresetModal() {
          const modal = document.getElementById("savePresetModal");
          modal.style.display = "none";
        }

        async function updatePresetPreview() {
          const previewElement = document.getElementById(
            "preset-preview-content"
          );

          try {
            // 只获取模块配置
            const modulesResponse = await fetch("/config/modules");
            const modulesConfig = modulesResponse.ok
              ? await modulesResponse.json()
              : [];

            // 渲染树形结构预览
            previewElement.innerHTML = renderPresetTreePreview(modulesConfig);
          } catch (error) {
            previewElement.innerHTML =
              '<p class="error">' +
              t(
                "error_loading_modules_config_prefix",
                "Error loading modules configuration: "
              ) +
              error.message +
              "</p>";
          }
        }

        function renderPresetTreePreview(modulesConfig) {
          if (!modulesConfig.length) {
            return `<p>${t("no_modules", "No modules available")}</p>`;
          }

          return modulesConfig
            .map(
              (module) => `
                    <div class="tree-node" data-module="${
                      module.name
                    }" data-enabled="${module.enabled}">
                        <div class="tree-header" onclick="togglePresetTreeNode(this)">
                            <span class="tree-toggle"></span>
                            <span class="tree-title">${module.name}</span>
                            <span class="tree-status ${
                              module.enabled ? "enabled" : "disabled"
                            }">
                                ${
                                  module.enabled
                                    ? t("status_enabled_symbol", "✓ Enabled")
                                    : t("status_disabled_symbol", "✗ Disabled")
                                }
                            </span>
                            <span class="method-count">${
                              module.methods ? module.methods.length : 0
                            } ${t("methods_suffix", "methods")}</span>
                        </div>
                        <div class="tree-content" style="display: none;">
                            <div class="config-summary">
                                <div class="config-item">
                                    <strong>${t(
                                      "summary_enabled",
                                      "Enabled:"
                                    )}</strong> ${
                module.enabled ? t("enabled_yes", "Yes") : t("enabled_no", "No")
              }
                                </div>
                                ${
                                  module.description
                                    ? `<div class="config-item"><strong>${t(
                                        "summary_description",
                                        "Description:"
                                      )}</strong> ${module.description}</div>`
                                    : ""
                                }
                                ${
                                  module.accessLevel
                                    ? `<div class="config-item"><strong>${t(
                                        "summary_access_level",
                                        "Access Level:"
                                      )}</strong> ${module.accessLevel}</div>`
                                    : ""
                                }
                                ${
                                  module.rateLimit
                                    ? `<div class="config-item"><strong>${t(
                                        "summary_rate_limit",
                                        "Rate Limit:"
                                      )}</strong> ${module.rateLimit} ${t(
                                        "req_per_min",
                                        "req/min"
                                      )}</div>`
                                    : ""
                                }
                            </div>
                            
                            <div class="tree-methods">
                                <h5>${t("methods_header", "Methods")} (${
                module.methods ? module.methods.length : 0
              }):</h5>
                                ${
                                  module.methods
                                    ? module.methods
                                        .map(
                                          (method) => `
                                    <div class="method-item">
                                        <div class="method-info">
                                            <span class="method-name">${
                                              method.name
                                            }</span>
                                            ${
                                              method.description
                                                ? `<span class="method-description">${method.description}</span>`
                                                : ""
                                            }
                                        </div>
                                        <div class="method-controls">
                                            <span class="method-status ${
                                              method.enabled
                                                ? "enabled"
                                                : "disabled"
                                            }">
                                                ${
                                                  method.enabled
                                                    ? t(
                                                        "status_enabled_label",
                                                        "Enabled"
                                                      )
                                                    : t(
                                                        "status_disabled_label",
                                                        "Disabled"
                                                      )
                                                }
                                            </span>
                                        </div>
                                    </div>
                                `
                                        )
                                        .join("")
                                    : `<p>${t(
                                        "no_methods",
                                        "No methods available"
                                      )}</p>`
                                }
                            </div>
                        </div>
                    </div>
                `
            )
            .join("");
        }

        function togglePresetTreeNode(header) {
          const content = header.nextElementSibling;
          const toggle = header.querySelector(".tree-toggle");

          if (content.style.display === "none") {
            // Expand
            content.style.display = "block";
            header.classList.add("expanded");
            header.classList.remove("collapsed");
            toggle.classList.add("expanded");
          } else {
            // Collapse
            content.style.display = "none";
            header.classList.remove("expanded");
            header.classList.add("collapsed");
            toggle.classList.remove("expanded");
          }
        }

        // Enhanced Tree-based Configuration Functions
        let currentConfig = {};
        let expandedNodes = new Set();

        // Core configuration fields (only these will be shown)
        const CORE_FIELDS = ["base_url", "auth"];

        // Field categories and their relationships
        const FIELD_CATEGORIES = {
          base_url: {
            category: "connection",
            label: "Base URL",
            description: "API server base URL",
          },
          auth: {
            category: "authentication",
            label: "Authentication",
            description: "Authentication settings",
            fields: ["auth_type", "username", "password", "token"],
          },
        };

        // Load configuration and render tree
        async function loadServerConfig() {
          try {
            const response = await fetch("/config/server");
            if (response.ok) {
              const result = await response.json();

              // Check if the response has the expected structure
              if (result.success && result.config) {
                // Extract the actual config data from the response
                const serverConfig = result.config;

                // Transform the server config to match the expected format
                currentConfig = {
                  base_url:
                    serverConfig.base_url ||
                    "https://119.96.179.118:8081/zentao/api.php/v1",
                  auth: {
                    mode: serverConfig.auth_mode || "direct",
                    direct_config: serverConfig.direct_config || null,
                    login_config: serverConfig.login_config || null,
                    token_refresh_buffer:
                      serverConfig.token_refresh_buffer || 300,
                    token_expiry_time: serverConfig.token_expiry_time || 3600,
                    max_retry_attempts: serverConfig.max_retry_attempts || 3,
                  },
                };

                renderEnhancedConfigTree(currentConfig);
                showTip(
                  t(
                    "msg_server_config_loaded",
                    "Configuration loaded successfully!"
                  ),
                  "success",
                  t("title_load_success", "Load Success")
                );
              } else {
                showTip(
                  t(
                    "msg_failed_load_configuration_prefix",
                    "Failed to load configuration: Invalid response format"
                  ),
                  "error",
                  t("title_load_error", "Load Error")
                );
              }
            } else {
              showTip(
                t(
                  "msg_failed_load_configuration_prefix",
                  "Failed to load configuration: "
                ) + response.statusText,
                "error",
                t("title_load_error", "Load Error")
              );
            }
          } catch (error) {
            showTip(
              t(
                "msg_error_loading_configuration_prefix",
                "Error loading configuration: "
              ) + error.message,
              "error",
              t("title_load_error", "Load Error")
            );
          }
        }

        // Render enhanced configuration tree (only core fields)
        function renderEnhancedConfigTree(config) {
          const treeContainer = document.getElementById("config-tree");
          if (!treeContainer) {
            console.warn("Config tree container not found.");
            return;
          }
          treeContainer.innerHTML = "";

          // Render core fields only (skip the outer wrapper)
          for (const field of CORE_FIELDS) {
            if (config.hasOwnProperty(field)) {
              const categoryInfo = FIELD_CATEGORIES[field] || { label: field };
              const html = renderCategoryTree(
                field,
                config[field],
                categoryInfo
              );
              treeContainer.innerHTML += html;
            }
          }
        }

        // Render category tree with enhanced UI
        function renderCategoryTree(key, value, categoryInfo) {
          const type = getValueType(value);
          const isExpandable = type === "object" || type === "array";
          const isExpanded = expandedNodes.has(key);
          const isNull = value === null;

          let html = `
                    <div class="category-section" data-category="${
                      categoryInfo.category
                    }">
                        <div class="category-header" onclick="toggleCategory('${key}')">
                            <div class="category-toggle ${
                              isExpandable
                                ? isExpanded
                                  ? "expanded"
                                  : ""
                                : "hidden"
                            }"></div>
                            <div class="category-title">
                                <span class="category-label">${
                                  categoryInfo.label
                                }</span>
                                <span class="category-description">${
                                  categoryInfo.description || ""
                                }</span>
                            </div>
                            <div class="category-type">${type}</div>
                        </div>
                `;

          if (isExpandable && isExpanded && !isNull) {
            html += `<div class="category-content">`;

            if (categoryInfo.dynamic) {
              // Dynamic content with add/remove controls
              html += renderDynamicContent(key, value, categoryInfo);
            } else {
              // Static content
              html += renderStaticContent(key, value, categoryInfo);
            }

            html += `</div>`;
          } else if (isNull) {
            // Null values are not editable
            html += `
                        <div class="category-content">
                            <div class="null-field">
                                <span class="null-label">This field is null and cannot be edited</span>
                            </div>
                        </div>
                    `;
          }

          html += `</div>`;
          return html;
        }

        // Render dynamic content (modules)
        function renderDynamicContent(key, value, categoryInfo) {
          let html = "";

          if (getValueType(value) === "object") {
            for (const [childKey, childValue] of Object.entries(value)) {
              const childType = getValueType(childValue);
              const isChildNull = childValue === null;

              html += `
                            <div class="dynamic-item">
                                <div class="dynamic-header">
                                    <span class="dynamic-label">${childKey}</span>
                                    <div class="dynamic-actions">
                                        ${
                                          !isChildNull
                                            ? `<button class="dynamic-btn edit" onclick="editDynamicItem('${key}', '${childKey}')">Edit</button>`
                                            : ""
                                        }
                                        <button class="dynamic-btn remove" onclick="removeDynamicItem('${key}', '${childKey}')">Remove</button>
                                    </div>
                                </div>
                                ${
                                  !isChildNull
                                    ? renderValuePreview(
                                        childKey,
                                        childValue,
                                        `${key}.${childKey}`
                                      )
                                    : ""
                                }
                            </div>
                        `;
            }

            // Add new item button
            html += `
                        <div class="add-item-section">
                            <button class="add-item-btn" onclick="addDynamicItem('${key}')">+ Add ${categoryInfo.label}</button>
                        </div>
                    `;
          }

          return html;
        }

        // Render static content (auth, base_url)
        function renderStaticContent(key, value, categoryInfo) {
          let html = "";

          if (getValueType(value) === "object") {
            for (const [childKey, childValue] of Object.entries(value)) {
              const isChildNull = childValue === null;

              html += `
                            <div class="static-item">
                                <div class="static-label">${childKey}</div>
                                <div class="static-value">
                                    ${
                                      !isChildNull
                                        ? renderEditableValue(
                                            childKey,
                                            childValue,
                                            `${key}.${childKey}`
                                          )
                                        : '<span class="null-value">null (not editable)</span>'
                                    }
                                </div>
                            </div>
                        `;
            }
          } else {
            html += `
                        <div class="static-item">
                            <div class="static-value">
                                ${renderEditableValue(key, value, key)}
                            </div>
                        </div>
                    `;
          }

          return html;
        }

        // Render value preview (for dynamic content)
        function renderValuePreview(key, value, path) {
          const type = getValueType(value);

          switch (type) {
            case "string":
              return `<div class="value-preview">${escapeHtml(value)}</div>`;
            case "number":
              return `<div class="value-preview">${value}</div>`;
            case "boolean":
              return `<div class="value-preview">${
                value ? "true" : "false"
              }</div>`;
            case "object":
              return `<div class="value-preview">Object with ${
                Object.keys(value).length
              } properties</div>`;
            case "array":
              return `<div class="value-preview">Array with ${value.length} items</div>`;
            default:
              return `<div class="value-preview">${escapeHtml(
                String(value)
              )}</div>`;
          }
        }

        // Render editable value input
        function renderEditableValue(key, value, path) {
          const type = getValueType(value);

          // Special handling for auth mode dropdown
          if (path === "auth.mode" || (path === "mode" && key === "mode")) {
            return `
              <select class="config-select" onchange="updateConfigValue('${path}', this.value)">
                <option value="direct" ${
                  value === "direct" ? "selected" : ""
                }>Direct Authentication</option>
                <option value="login" ${
                  value === "login" ? "selected" : ""
                }>Login Authentication</option>
              </select>
            `;
          }

          switch (type) {
            case "string":
              return `<input type="text" class="config-input" value="${escapeHtml(
                value
              )}" onchange="updateConfigValue('${path}', this.value)">`;
            case "number":
              return `<input type="number" class="config-input" value="${value}" onchange="updateConfigValue('${path}', parseFloat(this.value))">`;
            case "boolean":
              return `<input type="checkbox" class="config-checkbox" ${
                value ? "checked" : ""
              } onchange="updateConfigValue('${path}', this.checked)">`;
            default:
              return `<span>${escapeHtml(String(value))}</span>`;
          }
        }

        // Toggle category expansion
        function toggleCategory(path) {
          if (expandedNodes.has(path)) {
            expandedNodes.delete(path);
          } else {
            expandedNodes.add(path);
          }
          renderEnhancedConfigTree(currentConfig);
        }

        // Update configuration value
        function updateConfigValue(path, value) {
          const pathParts = path.split(".").filter((p) => p !== "");
          let current = currentConfig;

          for (let i = 0; i < pathParts.length - 1; i++) {
            current = current[pathParts[i]];
          }

          const lastPart = pathParts[pathParts.length - 1];
          current[lastPart] = value;
        }

        // Dynamic content management functions
        function addDynamicItem(category) {
          const itemName = prompt(`Enter name for new ${category}:`);
          if (itemName && itemName.trim()) {
            if (!currentConfig[category]) {
              currentConfig[category] = {};
            }

            // Add new item with default structure
            currentConfig[category][itemName.trim()] = {
              enabled: true,
              description: "",
              endpoints: {},
            };

            renderEnhancedConfigTree(currentConfig);
          }
        }

        function removeDynamicItem(category, itemName) {
          if (confirm(`Are you sure you want to remove ${itemName}?`)) {
            if (currentConfig[category] && currentConfig[category][itemName]) {
              delete currentConfig[category][itemName];
              renderEnhancedConfigTree(currentConfig);
            }
          }
        }

        function editDynamicItem(category, itemName) {
          // For now, just expand the item to show editable fields
          expandedNodes.add(`${category}.${itemName}`);
          renderEnhancedConfigTree(currentConfig);
        }

        // Get value type (moved from previous implementation)
        function getValueType(value) {
          if (value === null) return "null";
          if (Array.isArray(value)) return "array";
          if (typeof value === "object") return "object";
          return typeof value;
        }

        // Escape HTML for safe rendering
        function escapeHtml(text) {
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        }

        // Save configuration
        async function saveServerConfig() {
          try {
            const payload = buildServerPayload();

            const response = await fetch("/config/server", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (response.ok) {
              showTip(
                t(
                  "msg_server_config_saved",
                  "Configuration saved successfully!"
                ),
                "success",
                t("title_save_success", "Save Success")
              );
            } else {
              const result = await response.json();
              showTip(
                t(
                  "msg_failed_save_configuration_prefix",
                  "Failed to save configuration: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_save_error", "Save Error")
              );
            }
          } catch (error) {
            showTip(
              t(
                "msg_error_saving_configuration_prefix",
                "Error saving configuration: "
              ) + error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        // Reset to default configuration
        async function resetToDefault() {
          try {
            const response = await fetch("/config/default");
            if (response.ok) {
              currentConfig = await response.json();
              renderEnhancedConfigTree(currentConfig);
              showTip(
                t(
                  "msg_config_reset_to_default",
                  "Configuration reset to default!"
                ),
                "success",
                t("title_reset_success", "Reset Success")
              );
            } else {
              showTip(
                t(
                  "msg_failed_reset_configuration_prefix",
                  "Failed to reset configuration: "
                ) + response.statusText,
                "error",
                t("title_reset_error", "Reset Error")
              );
            }
          } catch (error) {
            showTip(
              t(
                "msg_error_resetting_configuration_prefix",
                "Error resetting configuration: "
              ) + error.message,
              "error",
              t("title_reset_error", "Reset Error")
            );
          }
        }

        // Tree control functions
        function expandAll() {
          // Collect all expandable paths using the correct path format
          expandedNodes.clear();
          for (const field of CORE_FIELDS) {
            if (currentConfig.hasOwnProperty(field)) {
              expandedNodes.add(field);
            }
          }
          renderEnhancedConfigTree(currentConfig);
        }

        function collapseAll() {
          expandedNodes.clear();
          renderEnhancedConfigTree(currentConfig);
        }

        function filterTree() {
          const searchTerm = document
            .getElementById("tree-search")
            .value.toLowerCase();
          // Implementation would require more complex tree filtering
          // For now, just highlight matching items
          const items = document.querySelectorAll(".tree-item");
          items.forEach((item) => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
              item.style.backgroundColor = "#fff3cd";
            } else {
              item.style.backgroundColor = "";
            }
          });
        }

        // Helper function to collect expandable paths
        function collectExpandablePaths(obj, path) {
          const type = getValueType(obj);
          if (type === "object" || type === "array") {
            expandedNodes.add(path);
            if (type === "object") {
              for (const [key, value] of Object.entries(obj)) {
                collectExpandablePaths(value, `${path}.${key}`);
              }
            } else if (type === "array") {
              obj.forEach((item, index) => {
                collectExpandablePaths(item, `${path}[${index}]`);
              });
            }
          }
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        }

        // Collect configuration data from tree interface
        function collectConfigFromTree() {
          // Use the currentConfig object that's already populated from the tree
          const config = {
            base_url:
              currentConfig.base_url ||
              "https://119.96.179.118:8081/zentao/api.php/v1",
            auth: {
              mode: currentConfig.auth?.mode || "direct",
              token_expiry_time: currentConfig.auth?.token_expiry_time || 3600,
              token_refresh_buffer:
                currentConfig.auth?.token_refresh_buffer || 300,
              max_retry_attempts: currentConfig.auth?.max_retry_attempts || 3,
              direct_config: currentConfig.auth?.direct_config || null,
              login_config: currentConfig.auth?.login_config || null,
            },
            server_port: 8081, // Default port
            log_level: "info", // Default log level
          };

          return config;
        }

        // Update saveServerConfig to use enhanced editor values
        async function saveServerConfig() {
          try {
            const payload = buildServerPayload();

            const response = await fetch("/config/server", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (response.ok) {
              showTip(
                t(
                  "msg_server_config_saved",
                  "Configuration saved successfully!"
                ),
                "success",
                t("title_save_success", "Save Success")
              );
            } else {
              const result = await response.json();
              showTip(
                t(
                  "msg_failed_save_configuration_prefix",
                  "Failed to save configuration: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_save_error", "Save Error")
              );
            }
          } catch (error) {
            showTip(
              t(
                "msg_error_saving_configuration_prefix",
                "Error saving configuration: "
              ) + error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        async function savePreset() {
          const presetId = document
            .getElementById("preset-id-input")
            .value.trim();
          const presetName = document
            .getElementById("preset-name-input")
            .value.trim();
          const presetDescription = document
            .getElementById("preset-description-input")
            .value.trim();

          if (!presetId || !presetName) {
            showTip(
              t(
                "validation_preset_required",
                "Preset ID and Name are required"
              ),
              "error",
              t("title_validation_error", "Validation Error")
            );
            return;
          }

          if (!/^[a-zA-Z0-9_-]+$/.test(presetId)) {
            showTip(
              t(
                "validation_preset_id_format",
                "Preset ID can only contain letters, numbers, underscores and hyphens"
              ),
              "error",
              t("title_validation_error", "Validation Error")
            );
            return;
          }

          try {
            const presetData = {
              id: presetId,
              name: presetName,
              description: presetDescription || null,
            };

            const response = await fetch("/config/presets", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(presetData),
            });

            if (response.ok) {
              const result = await response.json();
              console.log(result);

              if (result.success) {
                showTip(
                  t("msg_preset_saved_success", "Preset saved successfully!"),
                  "success",
                  t("title_save_success", "Save Success")
                );
                closeSavePresetModal();
                await loadPresets(); // 重新加载预设列表
              } else {
                showTip(
                  t(
                    "msg_failed_save_preset_prefix",
                    "Failed to save preset: "
                  ) + (result.message || t("unknown_error", "Unknown error")),
                  "error",
                  t("title_save_error", "Save Error")
                );
              }
            } else {
              const result = await response.json();
              showTip(
                t("msg_failed_save_preset_prefix", "Failed to save preset: ") +
                  (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_save_error", "Save Error")
              );
            }
          } catch (error) {
            showTip(
              t("msg_error_saving_preset_prefix", "Error saving preset: ") +
                error.message,
              "error",
              t("title_save_error", "Save Error")
            );
          }
        }

        async function applyPreset(presetId) {
          try {
            const response = await fetch(`/config/preset/${presetId}`, {
              method: "POST",
            });

            if (response.ok) {
              const result = await response.json();
              if (result.success) {
                showTip(
                  t("msg_preset_applied", "Preset applied successfully!"),
                  "success",
                  t("title_apply_success", "Apply Success")
                );
                // 重新加载模块配置以显示更新后的状态
                await loadModules();
              } else {
                showTip(
                  t(
                    "msg_failed_apply_preset_prefix",
                    "Failed to apply preset: "
                  ) + (result.message || t("unknown_error", "Unknown error")),
                  "error",
                  t("title_apply_error", "Apply Error")
                );
              }
            } else {
              const result = await response.json();
              showTip(
                t(
                  "msg_failed_apply_preset_prefix",
                  "Failed to apply preset: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_apply_error", "Apply Error")
              );
            }
          } catch (error) {
            showTip(
              t("msg_error_applying_preset_prefix", "Error applying preset: ") +
                error.message,
              "error",
              t("title_apply_error", "Apply Error")
            );
          }
        }

        async function deletePreset(presetId) {
          if (
            !confirm(
              t(
                "confirm_delete_preset",
                "Are you sure you want to delete this preset? This action cannot be undone."
              )
            )
          ) {
            return;
          }

          try {
            const response = await fetch(`/config/presets/${presetId}`, {
              method: "DELETE",
            });

            if (response.ok) {
              showTip(
                t("msg_preset_deleted_success", "Preset deleted successfully!"),
                "success",
                t("title_delete_success", "Delete Success")
              );
              await loadPresets(); // 重新加载预设列表
            } else {
              const result = await response.json();
              showTip(
                t(
                  "msg_failed_delete_preset_prefix",
                  "Failed to delete preset: "
                ) + (result.message || t("unknown_error", "Unknown error")),
                "error",
                t("title_delete_error", "Delete Error")
              );
            }
          } catch (error) {
            showTip(
              t("msg_error_deleting_preset_prefix", "Error deleting preset: ") +
                error.message,
              "error",
              t("title_delete_error", "Delete Error")
            );
          }
        }

        // 预设管理相关函数
        function showPresetManagement() {
          const section = document.getElementById("presetManagementSection");
          section.style.display =
            section.style.display === "none" ? "block" : "none";
        }

        // Headers Management Functions
        function addHeader() {
          const container = document.getElementById("custom-headers-container");
          const headerPair = document.createElement("div");
          headerPair.className = "header-pair";
          headerPair.innerHTML = `
            <input type="text" class="header-key" placeholder="Header Key">
            <input type="text" class="header-value" placeholder="Header Value">
            <button type="button" class="remove-header" onclick="removeHeader(this)">×</button>
          `;
          container.appendChild(headerPair);
        }

        function addLoginHeader() {
          const container = document.getElementById("login-headers-container");
          const headerPair = document.createElement("div");
          headerPair.className = "header-pair";
          headerPair.innerHTML = `
            <input type="text" class="header-key" placeholder="Header Key">
            <input type="text" class="header-value" placeholder="Header Value">
            <button type="button" class="remove-header" onclick="removeHeader(this)">×</button>
          `;
          container.appendChild(headerPair);
        }

        function removeHeader(button) {
          const headerPair = button.parentElement;
          headerPair.remove();
        }

        // Get headers from container
        function getHeadersFromContainer(containerId) {
          const container = document.getElementById(containerId);
          const headers = {};
          const headerPairs = container.querySelectorAll(".header-pair");
          
          headerPairs.forEach(pair => {
            const keyInput = pair.querySelector(".header-key");
            const valueInput = pair.querySelector(".header-value");
            const key = keyInput.value.trim();
            const value = valueInput.value.trim();
            
            if (key && value) {
              headers[key] = value;
            }
          });
          
          return Object.keys(headers).length > 0 ? headers : null;
        }

        // Set headers to container
        function setHeadersToContainer(containerId, headers) {
          const container = document.getElementById(containerId);
          container.innerHTML = "";
          
          if (headers && typeof headers === "object") {
            Object.entries(headers).forEach(([key, value]) => {
              const headerPair = document.createElement("div");
              headerPair.className = "header-pair";
              headerPair.innerHTML = `
                <input type="text" class="header-key" placeholder="Header Key" value="${key}">
                <input type="text" class="header-value" placeholder="Header Value" value="${value}">
                <button type="button" class="remove-header" onclick="removeHeader(this)">×</button>
              `;
              container.appendChild(headerPair);
            });
          } else {
            // Add default header pair
            const headerPair = document.createElement("div");
            headerPair.className = "header-pair";
            headerPair.innerHTML = `
              <input type="text" class="header-key" placeholder="Header Key" value="Content-Type">
              <input type="text" class="header-value" placeholder="Header Value" value="application/json">
              <button type="button" class="remove-header" onclick="removeHeader(this)">×</button>
            `;
            container.appendChild(headerPair);
          }
        }

        // Body management functions
        function addLoginBody() {
          const container = document.getElementById('login-body-container');
          if (!container) return;
          
          const pair = document.createElement('div');
          pair.className = 'body-pair';
          pair.innerHTML = `
            <input type="text" class="body-key config-input" placeholder="Parameter Key" value="">
            <input type="text" class="body-value config-input" placeholder="Parameter Value" value="">
            <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
          `;
          container.appendChild(pair);
        }

        function removeBody(button) {
          const pair = button.closest('.body-pair');
          if (pair) {
            pair.remove();
          }
        }

        function getBodyFromContainer(containerId) {
          const container = document.getElementById(containerId);
          if (!container) return null;
          
          const bodyPairs = container.querySelectorAll('.body-pair');
          const content = {};
          
          bodyPairs.forEach(pair => {
            const keyInput = pair.querySelector('.body-key');
            const valueInput = pair.querySelector('.body-value');
            
            if (keyInput && valueInput && keyInput.value.trim()) {
              content[keyInput.value.trim()] = valueInput.value.trim();
            }
          });
          
          const formatSelect = document.getElementById('login_auth_type');
          const format = formatSelect ? (formatSelect.value || 'json') : 'json';
          
          if (Object.keys(content).length === 0) {
            return null;
          }
          
          return { format, content };
        }

        function setBodyToContainer(containerId, body) {
          const container = document.getElementById(containerId);
          if (!container) return;
          
          // Clear existing body
          container.innerHTML = '';
          
          // Prefer nested content structure if provided
          let content = body;
          if (body && typeof body === 'object' && body.content && typeof body.content === 'object') {
            content = body.content;
          }
          
          // If no content provided, add default account/password
          if (!content || Object.keys(content).length === 0) {
            const accountPair = document.createElement('div');
            accountPair.className = 'body-pair';
            accountPair.innerHTML = `
              <input type="text" class="body-key config-input" placeholder="Parameter Key" value="account">
              <input type="text" class="body-value config-input" placeholder="Parameter Value" value="">
              <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
            `;
            container.appendChild(accountPair);
            
            const passwordPair = document.createElement('div');
            passwordPair.className = 'body-pair';
            passwordPair.innerHTML = `
              <input type="text" class="body-key config-input" placeholder="Parameter Key" value="password">
              <input type="text" class="body-value config-input" placeholder="Parameter Value" value="">
              <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
            `;
            container.appendChild(passwordPair);
            return;
          }
          
          // Add provided body parameters from content
          Object.entries(content).forEach(([key, value]) => {
            const pair = document.createElement('div');
            pair.className = 'body-pair';
            pair.innerHTML = `
              <input type="text" class="body-key config-input" placeholder="Parameter Key" value="${key}">
              <input type="text" class="body-value config-input" placeholder="Parameter Value" value="${value}">
              <button type="button" class="remove-body" onclick="removeBody(this)">×</button>
            `;
            container.appendChild(pair);
          });
        }

        // Token Extraction Management Functions
        function addTokenExtraction() {
          const container = document.getElementById('token-extraction-container');
          if (!container) return;
          
          const extractionPair = document.createElement('div');
          extractionPair.className = 'token-extraction-pair';
          extractionPair.innerHTML = `
            <div class="extraction-source">
              <label data-i18n="label_source_location">Source Location:</label>
              <select class="source-location config-select">
                <option value="body" data-i18n="response_body">Response Body</option>
                <option value="header" data-i18n="response_header">Response Header</option>
              </select>
            </div>
            <div class="extraction-key">
              <label data-i18n="label_token_key">Token Key:</label>
              <input type="text" class="token-key config-input" placeholder="token" value="token" data-i18n-placeholder="placeholder_token_key" />
            </div>
            <div class="extraction-format">
              <label data-i18n="label_token_format">Token Format:</label>
              <select class="token-format config-select">
                <option value="bearer" data-i18n="token_format_bearer">Bearer</option>
                <option value="raw" data-i18n="token_format_raw">Raw</option>
              </select>
            </div>
            <div class="extraction-target">
              <label data-i18n="label_target_location">Target Location:</label>
              <select class="target-location config-select">
                <option value="header" data-i18n="request_header">Request Header</option>
                <option value="body" data-i18n="request_body">Request Body</option>
              </select>
            </div>
            <div class="extraction-target-key">
              <label data-i18n="label_target_key">Target Key:</label>
              <input type="text" class="target-key config-input" placeholder="Authorization" value="Authorization" data-i18n-placeholder="placeholder_target_key" />
            </div>
            <button type="button" class="remove-token-extraction" onclick="removeTokenExtraction(this)">×</button>
          `;
          container.appendChild(extractionPair);
          // Refresh translations for newly inserted elements
          applyTranslations();
        }

        function removeTokenExtraction(button) {
          const extractionPair = button.closest('.token-extraction-pair');
          if (extractionPair) {
            extractionPair.remove();
          }
        }

        function getTokenExtractionFromContainer() {
          const container = document.getElementById('token-extraction-container');
          if (!container) return [];
          
          const extractionPairs = container.querySelectorAll('.token-extraction-pair');
          const tokens = [];
          
          extractionPairs.forEach(pair => {
            const sourceLocation = pair.querySelector('.source-location').value;
            const tokenKey = pair.querySelector('.token-key').value.trim();
            const tokenFormat = pair.querySelector('.token-format').value;
            const targetLocation = pair.querySelector('.target-location').value;
            const targetKey = pair.querySelector('.target-key').value.trim();
            
            if (tokenKey && targetKey) {
              tokens.push({
                source_location: sourceLocation,
                source_key: tokenKey,
                format: tokenFormat,
                target_location: targetLocation,
                target_key: targetKey
              });
            }
          });
          
          return tokens;
        }

        function setTokenExtractionToContainer(tokensOrConfig) {
          const container = document.getElementById('token-extraction-container');
          if (!container) return;
          const tokens = Array.isArray(tokensOrConfig) ? tokensOrConfig : ((tokensOrConfig && tokensOrConfig.tokens) || []);
          
          // Clear existing token extraction pairs
          container.innerHTML = '';
          
          // If no tokens provided, add default token extraction
          if (!tokens || tokens.length === 0) {
            const extractionPair = document.createElement('div');
            extractionPair.className = 'token-extraction-pair';
            extractionPair.innerHTML = `
              <div class="extraction-source">
                <label data-i18n="label_source_location">Source Location:</label>
                <select class="source-location config-select">
                  <option value="body" selected data-i18n="response_body">Response Body</option>
                  <option value="header" data-i18n="response_header">Response Header</option>
                </select>
              </div>
              <div class="extraction-key">
                <label data-i18n="label_token_key">Token Key:</label>
                <input type="text" class="token-key config-input" placeholder="token" value="token" data-i18n-placeholder="placeholder_token_key" />
              </div>
              <div class="extraction-format">
                <label data-i18n="label_token_format">Token Format:</label>
                <select class="token-format config-select">
                  <option value="bearer" selected data-i18n="token_format_bearer">Bearer</option>
                  <option value="raw" data-i18n="token_format_raw">Raw</option>
                </select>
              </div>
              <div class="extraction-target">
                <label data-i18n="label_target_location">Target Location:</label>
                <select class="target-location config-select">
                  <option value="header" selected data-i18n="request_header">Request Header</option>
                  <option value="body" data-i18n="request_body">Request Body</option>
                </select>
              </div>
              <div class="extraction-target-key">
                <label data-i18n="label_target_key">Target Key:</label>
                <input type="text" class="target-key config-input" placeholder="Authorization" value="Authorization" data-i18n-placeholder="placeholder_target_key" />
              </div>
              <button type="button" class="remove-token-extraction" onclick="removeTokenExtraction(this)">×</button>
            `;
            container.appendChild(extractionPair);
            // Refresh translations for newly inserted elements
            applyTranslations();
            return;
          }
          
          // Add provided token extraction configurations
          tokens.forEach(token => {
            const extractionPair = document.createElement('div');
            extractionPair.className = 'token-extraction-pair';
            extractionPair.innerHTML = `
              <div class="extraction-source">
                <label data-i18n="label_source_location">Source Location:</label>
                <select class="source-location config-select">
                  <option value="body" ${token.source_location === 'body' ? 'selected' : ''} data-i18n="response_body">Response Body</option>
                  <option value="header" ${token.source_location === 'header' ? 'selected' : ''} data-i18n="response_header">Response Header</option>
                </select>
              </div>
              <div class="extraction-key">
                <label data-i18n="label_token_key">Token Key:</label>
                <input type="text" class="token-key config-input" placeholder="token" value="${token.source_key || 'token'}" data-i18n-placeholder="placeholder_token_key" />
              </div>
              <div class="extraction-format">
                <label data-i18n="label_token_format">Token Format:</label>
                <select class="token-format config-select">
                  <option value="bearer" ${token.format === 'bearer' ? 'selected' : ''} data-i18n="token_format_bearer">Bearer</option>
                  <option value="raw" ${token.format === 'raw' ? 'selected' : ''} data-i18n="token_format_raw">Raw</option>
                </select>
              </div>
              <div class="extraction-target">
                <label data-i18n="label_target_location">Target Location:</label>
                <select class="target-location config-select">
                  <option value="header" ${token.target_location === 'header' ? 'selected' : ''} data-i18n="request_header">Request Header</option>
                  <option value="body" ${token.target_location === 'body' ? 'selected' : ''} data-i18n="request_body">Request Body</option>
                </select>
              </div>
              <div class="extraction-target-key">
                <label data-i18n="label_target_key">Target Key:</label>
                <input type="text" class="target-key config-input" placeholder="Authorization" value="${token.target_key || 'Authorization'}" data-i18n-placeholder="placeholder_target_key" />
              </div>
              <button type="button" class="remove-token-extraction" onclick="removeTokenExtraction(this)">×</button>
            `;
            container.appendChild(extractionPair);
          });
          // Refresh translations for newly inserted elements
          applyTranslations();
        }
      </script>
    </div>
  </body>
</html>
